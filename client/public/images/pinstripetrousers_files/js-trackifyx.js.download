const tfx_shop_settings={shop_id:28094,shop:"commenses.myshopify.com",plan:"shopify_plus",tfx_plan:{optin:!1,popular:!1,price:29.99,extraPixelPrice:19,shopifyPrices:{Development:10.99,BasicShopify:29.99,Shopify:59.99,AdvancedShopify:99.99,ShopifyPlus:199.99},isPlanAvailable:!0,ui:{color:"#3b4f66",border:"#3f3f3f",width:"auto"},limits:{pixels:8,"Server-Side API":"Purchase events","Non-Purchase events Server-Side API":"","Niche Tracking Tags":"Unlimited",analytics:"4 Months","Auto Catalog Feed":"","Custom Diagnosis":"","Scripts & Coding":"Custom","Feed Options":"Enterprise","FB Audience Builder":"Advanced","Large Feed Support":"","Dedicated CS Manager":"","Biweekly Manual Pixel Audit":"","Pixel Audit Recommendations":"","Time Based Events":"Advanced","Report Variants":"","Advanced Matching":"","Report Microdata":"","Value Reporting":"","Price Value Reporting":"","InitiateCheckout Button Click":"",CCPA:"","Tracking Consent Api":"","Event To Fire":"","Enable IOS14 Suppression":"","Enable SS for pending status":""}},tfx_planName:"shopifyExtended",currency:"USD",debug:!1,baseURL:"https://trackifyx.redretarget.com",pixels:[{id:124271,pixel_id:"1036932283761925",type:"master",context:[""],enabled:!0,month_ago:"2021-11-09T15:52:31Z",serversideapi_enabled:!0,serversideapi_status:"",is_token_valid:!0}],orders:[],logging:!0,proxy:"a/tfx",user_agent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/19B74 [FBAN/FBIOS;FBDV/iPhone11,8;FBMD/iPhone;FBSN/iOS;FBSV/15.1;FBSS/2;FBID/phone;FBLC/en_US;FBOP/5]",user_ip:"2606:54c0:7680:ce8::c:2fb",id:36214,enabled:!0,report_variants:!1,advance_matching:!0,microdata:!1,value_reporting:!0,reporting_percentage:100,time_on_site:!1,ccpa:"disabled",tracking_consent_api:"ignore",event_to_fire:["pageViewEvent","viewContentEvent","viewCategoryEvent","purchaseEvent","addToCartEvent"],all_events_for_suppress:["viewCategoryEvent","customizeProductEvent","viewCartEvent","paymentLeadEvent","addShippingInfoEvent","addToWishListEvent","searchEvent","contactEvent","timerEvent","pageViewEvent","viewContentEvent","addPaymentInfoEvent","purchaseEvent","initiateCheckoutEvent","addToCartEvent","microData","buttonClick"],enable_ios14_suppression:!1,enable_ssevents_for_pending:!0,orders_purchase:!1,ocu_ss_api:0,shopify_pixel:!1,contents:!0,atc_click:!0,ic_switch:!0},CountryCode={AF:{phoneCode:"93"},AX:{phoneCode:"+358-18"},AL:{phoneCode:"355"},DZ:{phoneCode:"213"},AS:{phoneCode:"+1-684"},AD:{phoneCode:"376"},AO:{phoneCode:"244"},AI:{phoneCode:"+1-264"},AQ:{phoneCode:""},AG:{phoneCode:"+1-268"},AR:{phoneCode:"54"},AM:{phoneCode:"374"},AW:{phoneCode:"297"},AU:{phoneCode:"61"},AT:{phoneCode:"43"},AZ:{phoneCode:"994"},BS:{phoneCode:"+1-242"},BH:{phoneCode:"973"},BD:{phoneCode:"880"},BB:{phoneCode:"+1-246"},BY:{phoneCode:"375"},BE:{phoneCode:"32"},BZ:{phoneCode:"501"},BJ:{phoneCode:"229"},BM:{phoneCode:"+1-441"},BT:{phoneCode:"975"},BO:{phoneCode:"591"},BA:{phoneCode:"387"},BW:{phoneCode:"267"},BV:{phoneCode:"0055"},BR:{phoneCode:"55"},IO:{phoneCode:"246"},BN:{phoneCode:"673"},BG:{phoneCode:"359"},BF:{phoneCode:"226"},BI:{phoneCode:"257"},KH:{phoneCode:"855"},CM:{phoneCode:"237"},CA:{phoneCode:"1"},CV:{phoneCode:"238"},KY:{phoneCode:"+1-345"},CF:{phoneCode:"236"},TD:{phoneCode:"235"},CL:{phoneCode:"56"},CN:{phoneCode:"86"},CX:{phoneCode:"61"},CC:{phoneCode:"61"},CO:{phoneCode:"57"},KM:{phoneCode:"269"},CG:{phoneCode:"242"},CD:{phoneCode:"243"},CK:{phoneCode:"682"},CR:{phoneCode:"506"},CI:{phoneCode:"225"},HR:{phoneCode:"385"},CU:{phoneCode:"53"},CY:{phoneCode:"357"},CZ:{phoneCode:"420"},DK:{phoneCode:"45"},DJ:{phoneCode:"253"},DM:{phoneCode:"+1-767"},DO:{phoneCode:"+1-809 and 1-829"},TL:{phoneCode:"670"},EC:{phoneCode:"593"},EG:{phoneCode:"20"},SV:{phoneCode:"503"},GQ:{phoneCode:"240"},ER:{phoneCode:"291"},EE:{phoneCode:"372"},ET:{phoneCode:"251"},FK:{phoneCode:"500"},FO:{phoneCode:"298"},FJ:{phoneCode:"679"},FI:{phoneCode:"358"},FR:{phoneCode:"33"},GF:{phoneCode:"594"},PF:{phoneCode:"689"},TF:{phoneCode:""},GA:{phoneCode:"241"},GM:{phoneCode:"220"},GE:{phoneCode:"995"},DE:{phoneCode:"49"},GH:{phoneCode:"233"},GI:{phoneCode:"350"},GR:{phoneCode:"30"},GL:{phoneCode:"299"},GD:{phoneCode:"+1-473"},GP:{phoneCode:"590"},GU:{phoneCode:"+1-671"},GT:{phoneCode:"502"},GG:{phoneCode:"+44-1481"},GN:{phoneCode:"224"},GW:{phoneCode:"245"},GY:{phoneCode:"592"},HT:{phoneCode:"509"},HM:{phoneCode:""},HN:{phoneCode:"504"},HK:{phoneCode:"852"},HU:{phoneCode:"36"},IS:{phoneCode:"354"},IN:{phoneCode:"91"},ID:{phoneCode:"62"},IR:{phoneCode:"98"},IQ:{phoneCode:"964"},IE:{phoneCode:"353"},IL:{phoneCode:"972"},IT:{phoneCode:"39"},JM:{phoneCode:"+1-876"},JP:{phoneCode:"81"},JE:{phoneCode:"+44-1534"},JO:{phoneCode:"962"},KZ:{phoneCode:"7"},KE:{phoneCode:"254"},KI:{phoneCode:"686"},KP:{phoneCode:"850"},KR:{phoneCode:"82"},KW:{phoneCode:"965"},KG:{phoneCode:"996"},LA:{phoneCode:"856"},LV:{phoneCode:"371"},LB:{phoneCode:"961"},LS:{phoneCode:"266"},LR:{phoneCode:"231"},LY:{phoneCode:"218"},LI:{phoneCode:"423"},LT:{phoneCode:"370"},LU:{phoneCode:"352"},MO:{phoneCode:"853"},MK:{phoneCode:"389"},MG:{phoneCode:"261"},MW:{phoneCode:"265"},MY:{phoneCode:"60"},MV:{phoneCode:"960"},ML:{phoneCode:"223"},MT:{phoneCode:"356"},IM:{phoneCode:"+44-1624"},MH:{phoneCode:"692"},MQ:{phoneCode:"596"},MR:{phoneCode:"222"},MU:{phoneCode:"230"},YT:{phoneCode:"262"},MX:{phoneCode:"52"},FM:{phoneCode:"691"},MD:{phoneCode:"373"},MC:{phoneCode:"377"},MN:{phoneCode:"976"},ME:{phoneCode:"382"},MS:{phoneCode:"+1-664"},MA:{phoneCode:"212"},MZ:{phoneCode:"258"},MM:{phoneCode:"95"},NA:{phoneCode:"264"},NR:{phoneCode:"674"},NP:{phoneCode:"977"},BQ:{phoneCode:"599"},NL:{phoneCode:"31"},NC:{phoneCode:"687"},NZ:{phoneCode:"64"},NI:{phoneCode:"505"},NE:{phoneCode:"227"},NG:{phoneCode:"234"},NU:{phoneCode:"683"},NF:{phoneCode:"672"},MP:{phoneCode:"+1-670"},NO:{phoneCode:"47"},OM:{phoneCode:"968"},PK:{phoneCode:"92"},PW:{phoneCode:"680"},PS:{phoneCode:"970"},PA:{phoneCode:"507"},PG:{phoneCode:"675"},PY:{phoneCode:"595"},PE:{phoneCode:"51"},PH:{phoneCode:"63"},PN:{phoneCode:"870"},PL:{phoneCode:"48"},PT:{phoneCode:"351"},PR:{phoneCode:"+1-787 and 1-939"},QA:{phoneCode:"974"},RE:{phoneCode:"262"},RO:{phoneCode:"40"},RU:{phoneCode:"7"},RW:{phoneCode:"250"},SH:{phoneCode:"290"},KN:{phoneCode:"+1-869"},LC:{phoneCode:"+1-758"},PM:{phoneCode:"508"},VC:{phoneCode:"+1-784"},BL:{phoneCode:"590"},MF:{phoneCode:"590"},WS:{phoneCode:"685"},SM:{phoneCode:"378"},ST:{phoneCode:"239"},SA:{phoneCode:"966"},SN:{phoneCode:"221"},RS:{phoneCode:"381"},SC:{phoneCode:"248"},SL:{phoneCode:"232"},SG:{phoneCode:"65"},SK:{phoneCode:"421"},SI:{phoneCode:"386"},SB:{phoneCode:"677"},SO:{phoneCode:"252"},ZA:{phoneCode:"27"},GS:{phoneCode:""},SS:{phoneCode:"211"},ES:{phoneCode:"34"},LK:{phoneCode:"94"},SD:{phoneCode:"249"},SR:{phoneCode:"597"},SJ:{phoneCode:"47"},SZ:{phoneCode:"268"},SE:{phoneCode:"46"},CH:{phoneCode:"41"},SY:{phoneCode:"963"},TW:{phoneCode:"886"},TJ:{phoneCode:"992"},TZ:{phoneCode:"255"},TH:{phoneCode:"66"},TG:{phoneCode:"228"},TK:{phoneCode:"690"},TO:{phoneCode:"676"},TT:{phoneCode:"+1-868"},TN:{phoneCode:"216"},TR:{phoneCode:"90"},TM:{phoneCode:"993"},TC:{phoneCode:"+1-649"},TV:{phoneCode:"688"},UG:{phoneCode:"256"},UA:{phoneCode:"380"},AE:{phoneCode:"971"},GB:{phoneCode:"44"},US:{phoneCode:"1"},UM:{phoneCode:"1"},UY:{phoneCode:"598"},UZ:{phoneCode:"998"},VU:{phoneCode:"678"},VA:{phoneCode:"379"},VE:{phoneCode:"58"},VN:{phoneCode:"84"},VG:{phoneCode:"+1-284"},VI:{phoneCode:"+1-340"},WF:{phoneCode:"681"},EH:{phoneCode:"212"},YE:{phoneCode:"967"},ZM:{phoneCode:"260"},ZW:{phoneCode:"263"},XK:{phoneCode:"383"},CW:{phoneCode:"599"},SX:{phoneCode:"1721"}},STCode={alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",colorado:"CO",connecticut:"CT",delaware:"DE",florida:"FL",georgia:"GA",hawaii:"HI",idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ","new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC","south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",washington:"WA","west Virginia":"WV",wisconsin:"WI",wyoming:"WY","american samoa":"AS",guam:"GU","northern mariana islands":"MP","puerto rico":"PR","virgin islands":"VI"};let pathname=location.pathname;(function(et){var ot={};function F(r){if(ot[r])return ot[r].exports;var b=ot[r]={i:r,l:!1,exports:{}};return et[r].call(b.exports,b,b.exports,F),b.l=!0,b.exports}F.m=et,F.c=ot,F.d=function(r,b,N){F.o(r,b)||Object.defineProperty(r,b,{enumerable:!0,get:N})},F.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},F.t=function(r,b){if(1&b&&(r=F(r)),8&b||4&b&&typeof r=="object"&&r&&r.__esModule)return r;var N=Object.create(null);if(F.r(N),Object.defineProperty(N,"default",{enumerable:!0,value:r}),2&b&&typeof r!="string")for(var at in r)F.d(N,at,function(T){return r[T]}.bind(null,at));return N},F.n=function(r){var b=r&&r.__esModule?function(){return r.default}:function(){return r};return F.d(b,"a",b),b},F.o=function(r,b){return Object.prototype.hasOwnProperty.call(r,b)},F.p="/",F(F.s=4)})({"/SWy":function(et,ot,F){"use strict";F.r(ot);var r,b=F("o0o1"),N=F.n(b);function at(v,p,m,C,e,t,o){try{var i=v[t](o),n=i.value}catch(a){return void m(a)}i.done?p(n):Promise.resolve(n).then(C,e)}function T(v){return function(p){if(Array.isArray(p)){for(var m=0,C=new Array(p.length);m<p.length;m++)C[m]=p[m];return C}}(v)||function(p){if(Symbol.iterator in Object(p)||Object.prototype.toString.call(p)==="[object Arguments]")return Array.from(p)}(v)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pt(v,p){for(var m=0;m<p.length;m++){var C=p[m];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(v,C.key,C)}}function ct(v,p){var m=Object.keys(v);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(v);p&&(C=C.filter(function(e){return Object.getOwnPropertyDescriptor(v,e).enumerable})),m.push.apply(m,C)}return m}function gt(v){for(var p=1;p<arguments.length;p++){var m=arguments[p]!=null?arguments[p]:{};p%2?ct(m,!0).forEach(function(C){c(v,C,m[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(m)):ct(m).forEach(function(C){Object.defineProperty(v,C,Object.getOwnPropertyDescriptor(m,C))})}return v}function c(v,p,m){return p in v?Object.defineProperty(v,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):v[p]=m,v}var ft=150,st="PageView",D="ViewContent",B="AddToCart",V="Purchase",L="InitiateCheckout",q="TrackifyXRetarget",Z="Products",nt="Orders",X="Collections",Y="ThankYou",ut="Search",K="ZipifyPage",z="GemProductPage",Q="BetterCartCheckoutThankYou",dt=(c(r={AF:"afghanistan",AL:"albania",DZ:"algeria",AS:"americansamoa",AD:"andorra",AO:"angola",AI:"anguilla",AQ:"antarctica",AG:"antiguaandbarbuda",AR:"argentina",AM:"armenia",AW:"aruba",AU:"australia",AT:"austria",AZ:"azerbaijan",BS:"bahamas",BH:"bahrain",BD:"bangladesh",BB:"barbados",BY:"belaruz",BE:"belgium",BZ:"belize",BJ:"benin",BM:"bermuda",BT:"bhutan",BO:"bolivia",BA:"bosniaandherzegovina",BW:"botswana",BV:"bouvetisland",BR:"brazil",BN:"brunei",BG:"bulgaria",BF:"burkinafaso",BI:"burundi",KH:"cambodia",CM:"cameroon",CA:"canada",CV:"capeVerde",KY:"caymanislands",CF:"centralafricanrepublic",TD:"chad",CL:"chile",CN:"china",CX:"christmasisland",CC:"cocos",CO:"colombia",KM:"comoros",CG:"congo",CK:"cookislands",CR:"costarica",CI:"cotedivoire",HR:"croatia",CU:"cuba",CY:"cyprus",CZ:"czechrepublic",CS:"czechoslavakia",DK:"denmark",DJ:"djibouti",DM:"dominica",DO:"dominicanrepublic",TP:"easttimor",EC:"ecuador",EG:"egypt",SV:"elsalvador",GQ:"equatorialguinea",ER:"eritrea",EE:"estonia",ET:"ethiopia",FK:"falklandislands",FO:"faroeislands",FJ:"fiji",FI:"finland",FR:"france",GF:"frenchguiana"},"GF","frenchguyana"),c(r,"PF","frencpolynesia"),c(r,"GA","gabon"),c(r,"GM","gambia"),c(r,"GE","georgia"),c(r,"DE","germany"),c(r,"GH","ghana"),c(r,"GI","gibraltar"),c(r,"GB","greatbritain"),c(r,"GB","unitedkingdom"),c(r,"GR","greece"),c(r,"GL","greenland"),c(r,"GD","grenada"),c(r,"GP","guadeloupe"),c(r,"GU","guam"),c(r,"GT","guatemala"),c(r,"GN","guinea"),c(r,"GW","guinea-bissau"),c(r,"GY","guyana"),c(r,"HT","haiti"),c(r,"HM","heardislandandmcdonaldislands"),c(r,"VA","holysee"),c(r,"VA","vaticancity"),c(r,"HN","honduras"),c(r,"HK","hongKong"),c(r,"HU","hungary"),c(r,"IS","iceland"),c(r,"IN","india"),c(r,"ID","indonesia"),c(r,"IR","iran"),c(r,"IR","islamicrepublicOfiran"),c(r,"IQ","iraq"),c(r,"IE","ireland"),c(r,"IL","israel"),c(r,"IT","italy"),c(r,"JM","jamaica"),c(r,"JP","japan"),c(r,"JO","jordan"),c(r,"KZ","kazakstan"),c(r,"KZ","kazakhstan"),c(r,"KE","kenya"),c(r,"KI","kiribati"),c(r,"KP","northkorea"),c(r,"KR","southkorea"),c(r,"KW","kuwait"),c(r,"KG","kyrgyzstan"),c(r,"LA","laos"),c(r,"LV","latvia"),c(r,"LB","lebanon"),c(r,"LS","lesotho"),c(r,"LR","liberia"),c(r,"LY","libya"),c(r,"LI","liechtenstein"),c(r,"LT","lithuania"),c(r,"LU","luxembourg"),c(r,"MO","macau"),c(r,"MK","macedonia"),c(r,"MG","madagascar"),c(r,"MW","malawi"),c(r,"MY","malaysia"),c(r,"MV","maldives"),c(r,"ML","mali"),c(r,"MT","malta"),c(r,"MH","marshallislands"),c(r,"MQ","martinique"),c(r,"MR","mauritania"),c(r,"MU","mauritius"),c(r,"YT","mayotte"),c(r,"MX","mexico"),c(r,"FM","micronesia"),c(r,"MD","moldova"),c(r,"MC","monaco"),c(r,"MN","mongolia"),c(r,"MS","montserrat"),c(r,"MA","morocco"),c(r,"MZ","mozambique"),c(r,"MM","myanmar"),c(r,"NA","namibia"),c(r,"NR","nauru"),c(r,"NP","nepal"),c(r,"NL","netherlands"),c(r,"AN","netherlandsantilles"),c(r,"NC","newcaledonia"),c(r,"NZ","newzealand"),c(r,"NI","nicaragua"),c(r,"NE","niger"),c(r,"NG","nigeria"),c(r,"NU","niue"),c(r,"NF","norfolkisland"),c(r,"MP","northernmarianaislands"),c(r,"NO","norway"),c(r,"OM","oman"),c(r,"PK","pakistan"),c(r,"PW","palau"),c(r,"PS","palestinianstate"),c(r,"PA","panama"),c(r,"PG","papuanewguinea"),c(r,"PY","paraguay"),c(r,"PE","peru"),c(r,"PH","philippines"),c(r,"PN","pitcairnisland"),c(r,"PL","poland"),c(r,"PT","portugal"),c(r,"PR","puertorico"),c(r,"QA","qatar"),c(r,"RO","romania"),c(r,"RU","russianfederation"),c(r,"RW","rwanda"),c(r,"SH","sainthelena"),c(r,"KN","saintKittsandnevis"),c(r,"LC","saintlucia"),c(r,"PM","saintpierreandmiquelon"),c(r,"VC","saintvincentandthegrenadines"),c(r,"WS","samoa"),c(r,"SM","sanmarino"),c(r,"ST","saotomeandtrincipe"),c(r,"SA","saudiarabia"),c(r,"RS","serbia"),c(r,"SN","senegal"),c(r,"SC","seychelles"),c(r,"SL","sierraleone"),c(r,"SG","singapore"),c(r,"SK","slovakia"),c(r,"SI","slovenia"),c(r,"SB","solomon"),c(r,"SO","somalia"),c(r,"ZA","southafrica"),c(r,"GS","southgeorgiaandthesouthsandwichislands"),c(r,"ES","spain"),c(r,"LK","sriLanka"),c(r,"SD","sudan"),c(r,"SR","suriname"),c(r,"SJ","svalbard"),c(r,"SZ","swaziland"),c(r,"SE","sweden"),c(r,"CH","switzerland"),c(r,"SY","syria"),c(r,"TW","taiwan"),c(r,"TJ","tajikistan"),c(r,"TZ","tanzania"),c(r,"TH","thailand"),c(r,"TG","togo"),c(r,"TK","tokelau"),c(r,"TO","tonga"),c(r,"TT","trinidadandtobago"),c(r,"TE","tromelinisland"),c(r,"TN","tunisia"),c(r,"TR","turkey"),c(r,"TM","turkmenistan"),c(r,"TC","turksandcaicosislands"),c(r,"TV","tuvalu"),c(r,"UG","uganda"),c(r,"UA","ukraine"),c(r,"AE","unitedarabemirates"),c(r,"US","unitedstates"),c(r,"UY","uruguay"),c(r,"UZ","uzbekistan"),c(r,"VU","vanuatu"),c(r,"VA","vaticancitystate"),c(r,"VE","venezuela"),c(r,"VN","vietnam"),c(r,"VI","virginislandsbritish"),c(r,"VQ","virginislandsunitedstates"),c(r,"WF","wallisandfutunaislands"),c(r,"EH","westernsahara"),c(r,"YE","yemen"),c(r,"YU","yugoslavia"),c(r,"ZR","zaire"),c(r,"ZM","zambia"),c(r,"ZW","zimbabwe"),r);function it(v){var p=null;return window.location.href.indexOf(v)>-1&&window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,C,e){p=e}),p}function j(v,p){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(m=gt({path:"/",SameSite:"Strict"},m)).expires&&m.expires.toUTCString&&(m.expires=m.expires.toUTCString());var C=encodeURIComponent(v)+"="+encodeURIComponent(p);for(var e in m){C+="; "+e;var t=m[e];t!==!0&&(C+="="+t)}document.cookie=C}function M(v){var p=document.cookie.match(new RegExp("(?:^|; )"+v.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return p?decodeURIComponent(p[1]):null}function $(v){j(v,"",{"max-age":-1})}function x(v,p){for(var m=p.split("."),C=0,e=m.length;C<e;C++){if(!v||!v[m[C]])return!1;v=v[m[C]]}return!0}function d(v,p){for(var m=p.split("."),C=0,e=m.length;C<e;C++){if(!v||!v[m[C]])return null;v=v[m[C]]}return v}function l(v){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(m,C){var e=new XMLHttpRequest;e.open(p.method||"GET",v),p.headers&&Object.keys(p.headers).forEach(function(t){e.setRequestHeader(t,p.headers[t])}),e.onload=function(){e.status>=200&&e.status<300?m(e.response):C(e.statusText)},e.onerror=function(){return C(e.statusText)},e.send(p.body)})}function h(v){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};let m=JSON.parse(p.body),C=p.client_ip_address;if(["ViewContent","AddToCart","InitiateCheckout","Purchase"].indexOf(m.ev)<0)return new Promise(function(S,U){S(null)});(JSON.stringify(C)==="{}"||!C)&&(C=FaceBook&&FaceBook.IpInfo||{});let e=localStorage.getItem("PIXELDATA");e&&(e=JSON.parse(e));let{am:t,us:o,ev:i,ssed:n,px:a}=m,s={country:o.country&&o.country.toUpperCase()||t&&t.country&&t.country.toUpperCase()||C.country_code&&C.country_code.toUpperCase(),external_id:(x(window,"ShopifyAnalytics.lib.user")?window.ShopifyAnalytics.lib.user().traits().uniqToken:null)||o.external_id||t.external_id,client_ip_address:C.ip||m.uip,client_user_agent:navigator.userAgent||window.ua,fbc:FaceBook&&FaceBook.Cookies._fbc||o.fbc||t&&t.fbc,fbp:FaceBook&&FaceBook.Cookies._fbp||o.fbp||t&&t.fbp,em:o.em||t&&t.em||(e?e.em:""),ph:o.ph||(e?e.ph:""),fn:o.fn||(e?e.fn:""),ln:o.ln||(e?e.ln:""),ct:o.ct||(e?e.ct:""),zp:o.zp||(e?e.zp:""),st:o.st||(e?e.st:"")},u={},g={ViewContent:0,AddToCart:1,InitiateCheckout:2,Purchase:3};u.event_type=g[i],u.event_params={event_name:i,event_time:parseInt(new Date(m.ts).getTime()/1e3).toString(),event_id:m.evId,event_source_url:m.url};let f=n.contents.reduce((S,U)=>S+U.quantity,0);u.custom_params={content_type:n.content_type,content_ids:typeof n.content_ids!="string"?[n.content_ids.toString()]:n.content_ids.map(S=>S.toString()),content_name:n.content_name,currency:n.currency,value:n.value,num_items:f.toString()||n.num_items||"1",content_category:n.content_category,contents:n.contents.map(S=>(S.id=S.id.toString(),S))},i==="Purchase"&&(u.custom_params.order_id=Number(m.evId));let P={pixel_id:a[0],distinct_id:FaceBook.GetCookie()},I={user:s,events:[u],site:"Commense",extra:P};return new Promise(function(S,U){if(I.user.country)fetch("https://capi.thecommense.com/capi/v1/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)}).then(R=>R.json()).then(R=>{S(R)}).catch(R=>U(R));else{let R=0,H=setInterval(()=>{let W=sessionStorage.getItem("IpInfo");W&&(clearInterval(H),W=JSON.parse(W),I.user.country=W.country_code.toUpperCase(),fetch("https://capi.thecommense.com/capi/v1/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)}).then(G=>G.json()).then(G=>{S(G)}).catch(G=>U(G)),R++,R>200&&clearInterval(H))},10)}})}function k(v,p,m,C,e,t){if(["ViewContent","AddToCart","InitiateCheckout","Purchase"].indexOf(m)>-1){let i={pixel_id:p,initData:t,data:C};i.event=m+"Data",m==="Purchase"&&(i.order_id=e.eventID),console.log(i),FaceBook.kinesis.putRecord({Data:JSON.stringify(i),PartitionKey:"partition-"+AWS.config.credentials.identityId,StreamName:"web-data-stream"},function(n,a){n&&console.log(n)})}}function E(){var v=new Date().toLocaleString("en-US",{timeZone:"America/New_York"}),p=new Date(v),m=p.toDateString().split(" "),C=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][p.getDay()];return m[1]+"_"+p.getDate()+"_"+p.getFullYear()+"_"+C+"_Hour_"+p.getHours()}function y(v){return typeof v!="string"?"":v.charAt(0).toUpperCase()+v.slice(1)}function _(v,p,m){p.split(" ").forEach(function(C){return v.addEventListener(C,m,!1)})}function rt(){var v,p={options:[],header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],init:function(){var m=this.header.join(" ");return{os:this.matchItem(m,this.dataos),browser:this.matchItem(m,this.databrowser)}},matchItem:function(m,C){var e,t,o,i=0,n=0;for(i=0;i<C.length;i+=1)if(new RegExp(C[i].value,"i").test(m)){if(e=new RegExp(C[i].version+"[- /:;]([\\d._]+)","i"),o="",(t=m.match(e))&&t[1]&&(t=t[1]),t)for(t=t.split(/[._]+/),n=0;n<t.length;n+=1)o+=n===0?t[n]+".":t[n];else o="0";return{name:C[i].name,version:parseFloat(o)}}return{name:"unknown",version:0}}}.init();return{osName:p.os?p.os.name:"unknown",osVersion:p.os?p.os.version:"unknown",browserName:p.browser?p.browser.name:"unknown",browserVersion:p.browser?p.browser.version:"unknown",navigatorUserAgent:navigator.version||"unknown",isMobile:(v=navigator.userAgent||navigator.vendor||window.opera,/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(v)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(v.substr(0,4))?1:0)}}function w(v,p,m){document.querySelector(v)||p<=0?m(document.querySelector(v)):window.setTimeout(function(){w(v,--p,m)},250)}function J(v,p,m){document.querySelectorAll(v)||p<=0?m(document.querySelectorAll(v)):window.setTimeout(function(){J(v,--p,m)},250)}var O=function(){function v(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,v),this.backendURL="https://trackifyx.redretarget.com",this.commenseBaseURL="https://capi.thecommense.com",this.uniqueId="_"+Math.random().toString(36).substr(2,9),this.shopName=null,this.shopHost="",this.shop=null,this.isZipifyTagsCollectionsLoaded=!1,this.isLogingZipifyTagsCollections=!1,this.zipifyProductsTagsCollections=[],this.collections=[],this.tags=[],this.pixels=[],this.initializedPixels=[],this.page=null,this.product=null,this.cart=null,this.checkout=null,this.isTriggeredByState=!1,this.isLoadingProduct=!1,this.isAddingToCart=!1,this.isFetchingShop=!1,this.isFetchingCart=!1,this.user=this.saveEmptyUser(),this.maxAttemps=ft,this.debug=!0,this.eventPrefix="",this.timeOnPage=0,this.reloadCartAttemps=5,this.timeOnSite=parseInt(localStorage.getItem("TFX_TIME_ON_SITE")||0),this.isLoaded=!1,this.productIds=[],this.pixelEvent=!0,this.advanceMatching=!0,this.isIOS14=!1,this.viewCategoryEventFire=!0,this.viewContentEventFire=!0,this.viewCartEventFire=!0,this.pageViewEventFire=!0,this.customizeProductEventFire=!0,this.addToCartEventFire=!0,this.initiateCheckoutEventFire=!0,this.addPaymentLeadEventFire=!0,this.addShippingInfoEventFire=!0,this.addPaymentInfoEventFire=!0,this.purchaseEventFire=!0,this.addToWishlistEventFire=!0,this.searchEventFire=!0,this.contactEventFire=!0,this.timerEventFire=!0,this.isScriptInIframe=window.self!==window.top,this.upsellInCartOnce=!0,this.incartForms=0,this.isBetterCart=!1,this.isPageFlyPage=!1,this.isShogunPage=!1,this.interCartEvents=[],this.interCartEvent=null,this.triggerQueue(),this.triggerATCQueue(),this.iscategoryswatchloaded=0,this.client_ip_address={},this.is_client_ip_address_loaded=!1}var p,m,C;return p=v,(m=[{key:"reset",value:function(){this.tags=[],this.collections=[],this.page=null,this.product=null,this.maxAttemps=ft}},{key:"init",value:function(){var e=this,t=window.location.href;t=t.replace("https://",""),!this.is_client_ip_address_loaded&&(t.includes("/products/")||t.includes("/cart")||t.includes("/thank_you")||t.includes("/checkouts/"))&&(this.is_client_ip_address_loaded=!0,this.getipInfo()),this.isResourcesLoaded()?this.shop.enabled?(this.loadIOSDeviceVersions(),this.setup()):this.consoleLog("This shop is disabled"):(this.maxAttemps===ft&&this.load(),setTimeout(function(){if(--e.maxAttemps<=0){var o=e.getFailMessage();e.consoleLog(o),e.consoleLog(e)}else e.load(),e.loadIOSDeviceVersions(),e.init()},30))}},{key:"getipInfo",value:function(){var e=this;l("https://freegeoip.app/json/").then(function(t){e.client_ip_address=JSON.parse(t)}).catch(function(t){_this.consoleLog("TFX",t)})}},{key:"initTrackingConsent",value:function(){var e=this;if(e.consoleLog("init tracking function is called"),d(window,"Shopify.loadFeatures"))e.consoleLog("Shopify.loadFeatures property loaded"),window.Shopify.loadFeatures([{name:"consent-tracking-api",version:"0.1"}],function(n){if(n)throw e.consoleLog(n,"Shopify.loadFeatures property error"),n;e.initCookieBanner()});else{if(e.consoleLog("Shopify.loadFeatures property not loaded"),!localStorage.getItem("TFX_CONSENT"))return;e.consoleLog("TFX Consent available");var t=JSON.parse(localStorage.getItem("TFX_CONSENT")),o=t.userCanBeTracked,i=t.userTrackingConsent;if(e.consoleLog(' tracking consent response : User Can Be Tracked "'.concat(o,'"')),e.consoleLog(' tracking consent response : Get Tracking consent "'.concat(i,'"')),!o&&i==="no_interaction"||i==="no")switch(this.shop.tracking_consent_api){case"all":this.pixelEvent=!1,e.consoleLog("Pixel Is blocked because tracking consent is not given");break;case"advance":e.consoleLog("Advance Matching Is blocked because tracking consent is not given"),this.advanceMatching=!1}}}},{key:"initCookieBanner",value:function(){var e=window.Shopify.customerPrivacy.userCanBeTracked();this.consoleLog("Cookie Banner Function is called");var t=window.Shopify.customerPrivacy.getTrackingConsent();this.consoleLog(' tracking consent response : User Can Be Tracked "'.concat(e,'"')),this.consoleLog(' tracking consent response : Get Tracking consent "'.concat(t,'"'));var o={userCanBeTracked:e,userTrackingConsent:t};if(this.setConsent(o),!e&&t==="no_interaction"||t==="no")switch(this.shop.tracking_consent_api){case"all":this.pixelEvent=!1,this.consoleLog("Pixel Is blocked because tracking consent is not given");break;case"advance":this.consoleLog("Advance Matching Is blocked because tracking consent is not given"),this.advanceMatching=!1}return!0}},{key:"setConsent",value:function(e){e&&localStorage.setItem("TFX_CONSENT",JSON.stringify(e))}},{key:"load",value:function(){this.setUTMs(),this.user||this.getUserExternalId(),this.page||this.setPage(),this.shopName||this.setShopName(),"fbq"in window||this.loadPixelLibrary(),!this.shop&&this.shopName&&this.loadShopSettings(),this.shop&&!this.product&&this.loadProduct(),this.tags.length||this.loadTags(),this.collections.length||this.loadCollections(),this.cart||this.loadCart(),[Y,nt,Q].indexOf(this.page)===-1||this.checkout||this.loadCheckout(),this.isTriggeredByState&&this.page===Z&&this.setTagsCollections(window.location.pathname),this.page!==K||this.isZipifyTagsCollectionsLoaded||this.setZipifyTagsCollections(),this.page==="UpSellPage"&&this.getOCUProduct()}},{key:"loadIOSDeviceVersions",value:function(){}},{key:"getFailMessage",value:function(){var e=[];switch("fbq"in window||e.push("FB Pixel script is not loaded"),this.shop||e.push("Can not get shop info"),this.shopName||e.push("Can not get shop name"),this.page||e.push("Can not get page"),this.page){case z:case"PageFly":case"Shogun":case Z:this.product||e.push("Can not get product checking zipify pages"),x(window,"ZipifyPages")&&(this.page=K,this.init());break;case"Cart":this.cart||e.push("Can not get cart");break;case Y:this.checkout||e.push("Can not get checkout")}return e.join(`
* `)}},{key:"isResourcesLoaded",value:function(){var e="fbq"in window&&this.shopName&&this.shop&&this.page,t=!0;switch(this.page){case z:case Z:t=this.product;break;case"PageFly":window.__pageflyProducts&&(t=this.product&&this.collections);break;case"Shogun":window.__shgProducts&&window.__shgProducts.length&&(t=this.product&&this.collections);break;case"Cart":t=this.cart;break;case Y:t=this.checkout}return e&&t}},{key:"setup",value:function(){if(this.isLoaded)this.consoleLog("TFX already loaded");else{this.setDebugMode(),this.consoleLog("setup function is called"),this.consoleLog("USER",this.user),this.initTrackingConsent();var e=this;setTimeout(function(){e.consoleLog("TFX ID: "+e.uniqueId),e.isLoaded=!0,e.setEventsPrefix(),e.consoleLog("Loaded",e),e.consoleLog(' Page is "'.concat(e.page,'"')),e.filterPixels()&&e.pixelEvent?(e.initPixels(),e.fireEvents(),e.isEventsAttached||e.attachListeners(),e.shop.time_on_site&&e.trackTime()):e.consoleLog("No Attached Pixels to current scenario")},500)}}},{key:"setEventsPrefix",value:function(){x(window,"OCUConfig")&&(this.eventPrefix="OCU")}},{key:"setDebugMode",value:function(){this.debug=this.shop.debug}},{key:"consoleLog",value:function(){if(this&&this.debug){var e=[];e.push("TFX:");for(var t=0;t<arguments.length;t++)e.push(arguments[t]);console.log.apply(console,e)}}},{key:"setPage",value:function(){var e=this,t=window.location.href,o=this;if((t=t.replace("https://","")).includes("/collections")&&(this.page=X),t.includes("/products/")&&(this.page=Z),t.includes("/cart"))this.page="Cart";else{if((t.includes("/checkouts/")||t.includes("/secure-checkout/")&&d(window,"OCUConfig"))&&(this.page="Checkout"),t.includes("/s/checkout/")&&(this.page="Checkout"),(t.includes("/secure-checkout/offers/")||t.includes("/secure-chechout/offers"))&&(this.page="UpSellPage"),t.includes("/thank_you")&&(this.page=Y),t.includes("/orders/")&&(this.page=nt),t.includes("/secure-checkout/thank_you/")&&(this.page="OCUThankYou"),t.includes("/account/login")&&(this.page="Login"),t.includes("/account/register")&&(this.page="SignUp"),t.includes("/search")&&(this.page=ut),t.includes("apps/fast-checkout/")){t.includes("checkouts")&&(this.page="BetterCartCheckout");var i=location.href;setInterval(function(){if(i!=location.href){i=location.href;var n=window.location.href;it("step")!="payment"||M("TFX_BC_PI")||(e.addPaymentInfoEvent(),j("TFX_BC_PI",!0,{"max-age":60})),(n.includes("fast-checkout/checkouts")&&n.includes("order")||n.includes("fast-checkout/orders")&&n.includes("thank-you"))&&!window.location.hash&&(window.location=window.location+"#loaded",n.includes("fast-checkout/orders")&&n.includes("thank-you")&&(o.isLoaded=!1,o.checkout=null,o.cart=null),o.reset(),setTimeout(function(){o.load(),o.attachListeners(),o.filterPixels(),o.initPixels()},500))}},1500),setTimeout(function(){o.initiateCheckoutEvent()},2e3)}t.includes("fast-checkout/checkouts")&&t.includes("order")&&(this.page="BetterCartCheckoutOffer"),t.includes("fast-checkout/orders")&&t.includes("thank-you")&&(this.page=Q),x(window,"ZipifyPages")&&!t.includes("/products/")&&(this.page=K),d(window,"CHDataObject.partial_type")==="checkout_page"&&(this.page="CartHookCheckout"),d(window,"CHDataObject.partial_type")==="thank_you_page"&&(this.page="CartHookThankYou"),d(window,"CHDataObject.partial_type")==="upsell_page"&&(this.page="CartHookUpSellPage"),d(window,"CHDataObject.partial_type")==="downsell_page"&&(this.page="CartHookDownSellPage"),d(window,"CHDataObject.partial_type")==="page"&&(this.page="CartHookPage"),document.querySelector("body.gempage")&&t.includes("/pages/")&&(this.page=z),(t.includes("/pages/")||t.includes("/blogs/news/")||t.includes("/password"))&&document.querySelector('link[href*="pagefly"]')&&(this.page="PageFly"),(t.includes("/pages/")||t.includes("/blogs/news/")||t.includes("/password"))&&document.querySelector('link[href*="shogun"]')&&(this.page="Shogun"),this.page||(this.page="Unknown")}}},{key:"loadPixelLibrary",value:function(){if("fbq"in window)return!0;var e,t,o,i,n,a;e=window,t=document,o="script",e.fbq||(i=e.fbq=function(){i.callMethod?i.callMethod.apply(i,arguments):i.queue.push(arguments)},e._fbq||(e._fbq=i),i.push=i,i.loaded=!0,i.version="2.0",i.queue=[],(n=t.createElement(o)).async=!0,n.src="https://connect.facebook.net/en_US/fbevents.js",(a=t.getElementsByTagName(o)[0]).parentNode.insertBefore(n,a))}},{key:"loadShopSettings",value:function(){if(typeof tfx_shop_settings!="undefined")console.log("config route not called"),this.shop=tfx_shop_settings,this.product||this.loadProduct();else{var e=this;if(e.isFetchingShop)return;e.isFetchingShop=!0,setTimeout(function(){e.isFetchingShop=!1},700),console.log("config route called"),l("".concat(this.backendURL,"/pull/config/").concat(this.shopName)).then(function(t){e.shop=JSON.parse(t),e.isFetchingShop=!1,e.product||e.loadProduct()}).catch(function(t){e.consoleLog("TFX",t)})}}},{key:"setShopName",value:function(){this.shopName=d(window,"Shopify.shop")||d(window,"Shopify.Checkout.apiHost")||d(window,"CHDataObject.store_urls.store_url"),window.getOrderRequestObject&&(this.shopName=window.getOrderRequestObject().shop),this.page!="BetterCartCheckout"&&this.page!="BetterCartCheckoutOffer"&&this.page!=Q||(this.shopName=window.location.hostname)}},{key:"getUserExternalId",value:function(){var e=this,t=5;(function o(){"Shopify"in window?e.setUser({external_id:x(window,"ShopifyAnalytics.lib.user")?window.ShopifyAnalytics.lib.user().traits().uniqToken:null}):--t>=0&&setTimeout(function(){e.consoleLog("time out for external ID"),o()},200)})()}},{key:"loadCheckout",value:function(){this.checkout=d(window,"Shopify.checkout"),this.checkout||this.page!=Q||(this.checkout=d(window,"bcData.order"),this.checkout.discount=d(window,"bcData.order.coupon"))}},{key:"printTags",value:function(e){var t=e||this.tags||(localStorage.getItem("tags")||"").split(", ");return t&&t.length?(e||(this.tags=t),T(new Set(t.map(function(o){return typeof o=="string"?o.toString().trim():o}).filter(function(o){return o.trim()!==""}))).join(", ")):""}},{key:"printCollections",value:function(e){var t=e||this.collections||(localStorage.getItem("collections")||"").split(", ");return t&&t.length?(e||(this.collections=t),T(new Set(t.map(function(o){return typeof o=="string"?o.toString().trim():o}).filter(function(o){return o.trim()!==""}))).join(", ")):""}},{key:"clearArray",value:function(e){return e&&Array.isArray(e)?e.map(function(t){return t.trim()}).filter(function(t){return t.length>0}):[]}},{key:"loadTags",value:function(){var e=document.querySelector('meta[name="tfx:tags"]');e?(this.tags=this.clearArray(e.content.split(", ")),localStorage.setItem("tags",this.tags.join(", "))):[Z,X,z,ut,K].indexOf(this.page)===-1&&(this.tags=(localStorage.getItem("tags")||"").split(", "))}},{key:"loadCollections",value:function(){var e=document.querySelector('meta[name="tfx:collections"]');if(e)this.collections=e.content.split(", ").map(function(o){return o.trim()}).filter(function(o){return o.length>0}),localStorage.setItem("collections",this.collections.join(", "));else{var t=localStorage.getItem("collections")||"";this.collections=t.split(", ")}}},{key:"extractTagsCollections",value:function(e){var t={tags:[],collections:[]},o=/<meta name="tfx:tags" content="(.*?)">/g.exec(e),i=/<meta name="tfx:collections" content="(.*?)">/g.exec(e);return o&&(t.tags=o[1].split(", ").map(function(n){return n.trim()}).filter(function(n){return n.length>0})),i&&(t.collections=i[1].split(", ").map(function(n){return n.trim()}).filter(function(n){return n.length>0})),t}},{key:"setTagsCollections",value:function(e){var t=this;this.getTagsCollections(e).then(function(o){var i=t.extractTagsCollections(o);t.tags=i.tags,localStorage.setItem("tags",t.clearArray(t.tags).join(", ")),t.collections=i.collections,localStorage.setItem("collections",t.clearArray(t.collections).join(", "))}).catch(this.consoleLog)}},{key:"getTagsCollections",value:function(e){return l(e)}},{key:"setTagsAndCollectionsFromBackend",value:function(e){var t=this,o=this;return e?new Promise(function(i,n){l("".concat(t.backendURL,"/get/").concat(t.shopName,"/products?ids=")+e.join(",")).then(function(a){var s=JSON.parse(a);if(s.products&&s.products.length){var u=s.products.map(function(g){return new Promise(function(f,P){t.getTagsCollections("".concat(t.shopHost,"/products/").concat(g.handle)).then(function(I){var S=t.extractTagsCollections(I);o.collections=o.collections.concat(S.collections),o.tags=o.tags.concat(S.tags),f({product_id:g.id,html:I})}).catch(function(I){P(I)})})});Promise.all(u).then(function(){o.tags=T(new Set(o.tags)),o.collections=T(new Set(o.collections)),o.filterPixels(),o.initPixels(),i()}).catch(function(g){i(g)})}else n("No products fetched...")}).catch(n)}):new Promise(function(i){return i()})}},{key:"getProduct",value:function(e){if(e)return l(e.endsWith("/")?e.slice(0,-1):e+".json")}},{key:"getProductById",value:function(e){if(e)return l("".concat(this.backendURL,"/get/").concat(this.shopName,"/products?ids=").concat(e))}},{key:"loadProduct",value:function(){var e=this;if(!this.isLoadingProduct){var t=window.tfxProduct||null;if(setTimeout(function(){e.incartForms==0&&(e.incartForms=document.querySelectorAll("form[action='/cart/add'].variants").length,e.consoleLog(e.incartForms+" upsell offer"))},1e3),t)this.product=t;else{var o=d(window,"ShopifyAnalytics.meta.page.pageType")?window.ShopifyAnalytics.meta.page.pageType:"Unknown";if(!window.__pageflyProducts||o!="home"&&o!="page"&&o!="article"&&o!="password"||(this.isPageFlyPage=!0),this.page==="PageFly"){if(!this.shop)return null;if(window.__pageflyProducts)for(var i in window.__pageflyProducts)window.__pageflyProducts.hasOwnProperty(i)&&i&&(this.product=gt({},window.__pageflyProducts[i].selected_or_first_available_variant),this.shop.report_variants||(this.product.id=parseInt(i)),this.tags=window.__pageflyProducts[i].tags,this.setTagsCollections("/products/".concat(window.__pageflyProducts[i].handle)))}else if(window.__shgProducts!==void 0&&(this.isShogunPage=!0,this.page==="Shogun")){if(!this.shop)return null;if(window.__shgProducts)for(var n in this.consoleLog("Is shogun product page"),window.__shgProducts)window.__shgProducts.hasOwnProperty(n)&&n&&(this.consoleLog("shogun product"),this.consoleLog(window.__shgProducts[n]),this.product=window.__shgProducts[n],this.tags=window.__shgProducts[n].tags,this.setTagsCollections("/products/".concat(window.__shgProducts[n].handle)))}this.page==="Cart"&&this.product==null&&this.incartForms>0&&this.getInCartUpsellProduct(this.upsellInCartOnce),this.consoleLog("load product called!!");var a=document.querySelectorAll("form[action='/cart/add']");if(this.consoleLog("load product addToCartForms.length: "+a.length),a.length>0&&this.page!=X&&!this.isPageFlyPage&&!this.isShogunPage){var s=a[0],u=s.querySelector('input[name="id"]'),g=s.getAttribute("id");this.consoleLog("Product Form detected, product id is ".concat(g)),u&&u.getAttribute("data-productid")&&(g=u.getAttribute("data-productid")),g&&(g=(g=(g=(g=(g=(g=(g=(g=g.replace("product_form_","")).replace("upsell_product_form_","")).replace("product-form-","")).replace("product-template","")).replace("AddToCartForm--","")).replace("AddToCartForm-","")).replace("js--","")).replace(/\D/g,""),isNaN(parseInt(g))&&(g=s.getAttribute("data-product_id")),this.consoleLog("Cleared Product ID is: ".concat(parseInt(g))),parseInt(g)&&(parseInt(g)<1e4&&document.querySelector("[product-id]")&&document.querySelector("[product-id]").getAttribute("class").indexOf("arv-collection")!=-1&&(g=document.querySelector("[product-id]").getAttribute("product-id"),this.consoleLog("more filters with Product ID is: ".concat(parseInt(g)))),this.isLoadingProduct=!0,this.getProductById(g).then(function(f){var P=JSON.parse(f);P.products&&P.products.length&&(e.product=P.products[0],e.setTagsCollections("/products/".concat(e.product.handle)),e.page!=Z&&setTimeout(function(){e.viewContentEvent()},500)),e.isLoadingProduct=!1}).catch(function(f){e.isLoadingProduct=!1,e.consoleLog("loadProduct",f)})))}this.product==null&&this.page==="BetterCartCheckoutOffer"&&(this.isLoadingProduct=!0,d(window,"bcData.product")&&this.getProductById(d(window,"bcData.product.product_id")).then(function(f){var P=JSON.parse(f);P.products&&P.products.length&&(e.product=P.products[0],e.isLoadingProduct=!1),e.isLoadingProduct=!1}).then(function(){e.viewContentEvent()}).catch(function(){e.isLoadingProduct=!1}))}}}},{key:"getInCartUpsellProduct",value:function(e){var t=this;e&&(this.upsellInCartOnce=!1,document.querySelectorAll("form[action='/cart/add'].variants").forEach(function(o){var i=o.querySelector('*[id^="product-select-"]').options[0].value;parseInt(i)&&l("".concat(t.backendURL,"/get/").concat(t.shopName,"/product/").concat(i,"/variant")).then(function(){var n,a=(n=N.a.mark(function s(u){var g,f;return N.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if((g=JSON.parse(u)).variant.product_id===void 0){P.next=6;break}return f="upsell_product_form_".concat(g.variant.product_id),o.setAttribute("id",f),P.next=6,t.getProductById(g.variant.product_id).then(function(I){var S=JSON.parse(I);S.products&&S.products.length&&(t.product=S.products[0],t.consoleLog("upsell offer product set",t.product))}).catch(function(I){t.consoleLog(I)});case 6:case"end":return P.stop()}},s)}),function(){var s=this,u=arguments;return new Promise(function(g,f){var P=n.apply(s,u);function I(U){at(P,g,f,I,S,"next",U)}function S(U){at(P,g,f,I,S,"throw",U)}I(void 0)})});return function(s){return a.apply(this,arguments)}}()).catch(function(n){t.consoleLog(n)})}))}},{key:"setCart",value:function(e){if(e){for(var t in this.cart||(this.cart={}),e)e.hasOwnProperty(t)&&(this.cart[t]=e[t]);localStorage.setItem("TFX_CART",JSON.stringify(this.cart))}}},{key:"setCartFromStorage",value:function(){var e=null;if(!localStorage.getItem("TFX_CART"))return e;try{this.cart=JSON.parse(localStorage.getItem("TFX_CART")),this.consoleLog("Set cart from storage",this.cart),e=!0}catch(t){this.consoleLog(t)}return e}},{key:"addToCart",value:function(e){if(e)try{var t=JSON.parse(localStorage.getItem("TFX_CART"));t||(t={items:[]},localStorage.setItem("TFX_CART",JSON.stringify(t)));var o=this.getVariant(e);o.line_price=this.shop.value_reporting?this.calculatePrice(o.price):"0.00",o.quantity=document.getElementsByName("quantity")[0]?document.getElementsByName("quantity")[0].value:1,o.product_type=e.product_type,t.items.find(function(i){return i.id===o.id})||(t.items.push(o),localStorage.setItem("TFX_CART",JSON.stringify(t))),this.cart=t}catch(i){this.consoleLog(i)}}},{key:"reloadCart",value:function(){var e=this;if(!this.isFetchingCart&&this.reloadCartAttemps!==0){this.isFetchingCart=!0;var t=d(this.cart,"item_count");l("".concat(this.shopHost,"/cart.json")).then(function(o){var i=JSON.parse(o);e.isFetchingCart=!1,i&&(e.consoleLog("data.items.length",t),i.item_count===t?(e.reloadCartAttemps--,setTimeout(function(){e.reloadCart()},500)):(e.cart=i,localStorage.setItem("TFX_CART",JSON.stringify(i))))}).catch(function(o){e.consoleLog(o),e.isFetchingCart=!1})}}},{key:"loadCart",value:function(){var e=this;if(!this.isFetchingCart){this.isFetchingCart=!0;var t=window.tfxCart||null;t?(this.cart=t,localStorage.setItem("TFX_CART",JSON.stringify(t)),this.isFetchingCart=!1):this.setCartFromStorage()?this.isFetchingCart=!1:l("".concat(this.shopHost,"/cart.json")).then(function(o){var i=JSON.parse(o);e.isFetchingCart=!1,i&&(e.cart=i,localStorage.setItem("TFX_CART",JSON.stringify(i)))}).catch(function(o){e.consoleLog(o),e.isFetchingCart=!1})}}},{key:"saveCartProduct",value:function(e){if(e)try{var t=JSON.parse(M("TFX_ATC"));t.push(e),j("TFX_ATC",JSON.stringify(T(new Set(t))),{"max-age":1209600})}catch{j("TFX_ATC",JSON.stringify([e]),{"max-age":600})}}},{key:"getSavedCartProducts",value:function(){var e=[];try{e=JSON.parse(M("TFX_ATC"))}catch(t){this.consoleLog(t)}return e||[]}},{key:"setAdvanceMatchingData",value:function(){this.page===Y||this.page===nt?d(window,"Shopify.checkout.shipping_address")?this.setUser({em:d(window,"Shopify.checkout.email"),fn:d(window,"Shopify.checkout.shipping_address.first_name")?d(window,"Shopify.checkout.shipping_address.first_name").toLowerCase():"",ln:d(window,"Shopify.checkout.shipping_address.last_name")?d(window,"Shopify.checkout.shipping_address.last_name").toLowerCase():"",ct:d(window,"Shopify.checkout.shipping_address.city")?d(window,"Shopify.checkout.shipping_address.city").toLowerCase().replace(/\s+/g,""):"",zp:d(window,"Shopify.checkout.shipping_address.zip")?d(window,"Shopify.checkout.shipping_address.zip").trim().toLowerCase():"",ph:x(window,"Shopify.checkout.shipping_address.phone")?d(window,"Shopify.checkout.shipping_address.phone"):null}):d(window,"Shopify.checkout.billing_address")?this.setUser({em:d(window,"Shopify.checkout.email"),fn:d(window,"Shopify.checkout.billing_address.first_name")?d(window,"Shopify.checkout.billing_address.first_name").toLowerCase():"",ln:d(window,"Shopify.checkout.billing_address.last_name")?d(window,"Shopify.checkout.billing_address.last_name").toLowerCase():"",ct:d(window,"Shopify.checkout.billing_address.city")?d(window,"Shopify.checkout.billing_address.city").toLowerCase().replace(/\s+/g,""):"",zp:d(window,"Shopify.checkout.billing_address.zip")?d(window,"Shopify.checkout.billing_address.zip").trim().toLowerCase():"",ph:x(window,"Shopify.checkout.billing_address.phone")?d(window,"Shopify.checkout.billing_address.phone"):null}):this.setUser({em:d(window,"Shopify.checkout.email"),fn:"",ln:"",ct:"",zp:"",ph:""}):this.page===Q&&d(window,"bcData.order.shipping_address")&&this.setUser({em:d(window,"bcData.order.customer.email"),fn:d(window,"bcData.order.shipping_address.first_name")?d(window,"bcData.order.shipping_address.first_name").toLowerCase():"",ln:d(window,"bcData.order.shipping_address.last_name")?d(window,"bcData.order.shipping_address.last_name").toLowerCase():"",ct:d(window,"bcData.order.shipping_address.city")?d(window,"bcData.order.shipping_address.city").toLowerCase().replace(/\s+/g,""):"",zp:d(window,"bcData.order.shipping_address.zip")?d(window,"bcData.order.shipping_address.zip").trim().toLowerCase():"",ph:x(window,"bcData.order.customer.phone")?d(window,"bcData.order.customer.phone"):""})}},{key:"getAdvanceMatchingData",value:function(){if(this.setAdvanceMatchingData(),!this.shop.advance_matching||!this.advanceMatching)return{};var e=this.getUser(),t={};for(var o in e)e.hasOwnProperty(o)&&e[o]&&"".concat(e[o]).trim()&&(t[o]=e[o].toLowerCase());if(t.country){var i=Object.keys(dt)[Object.values(dt).indexOf(t.country.toLowerCase().replace(/\s/g,""))];t.country=i?i.toLowerCase().replace(/\s/g,""):""}if(t.em&&(t.em=t.em.toLowerCase().replace(/\s+/g,"")),t.ph&&(t.ph=t.ph.replace(/\s+/g,"").match(/[0-9]/g).join("")),t.ct&&(t.ct=t.ct.toLowerCase().replace(/\s+/g,"")),t.zp&&(t.zp=t.zp.toLowerCase().replace(/\s+/g,"").replace(/\-/g,"")),t.st&&(t.st=t.st.toLowerCase().replace(/\s+/g,"")),Shopify.checkout&&Shopify.checkout.shipping_address){let s=Shopify.checkout.shipping_address;!t.country&&s.country_code&&(t.country=s.country_code.toLowerCase().replace(/\s+/g,"")),!t.st&&s.province&&(t.st=s.province.toLowerCase().replace(/\s+/g,"")),!t.zp&&s.zip&&(t.zp=s.zip.toLowerCase().replace(/\s+/g,"").replace(/\-/g,"")),!t.ct&&s.city&&(t.ct=s.city.toLowerCase().replace(/\s+/g,"")),!t.ph&&s.phone&&(t.ph=s.phone.replace(/\s+/g,"").match(/[0-9]/g).join("")),!t.fn&&s.first_name&&(t.fn=s.first_name.trim().toLowerCase()),!t.ln&&s.last_name&&(t.ln=s.last_name.trim().toLowerCase())}let n=localStorage.getItem("PIXELDATA");n&&(n=JSON.parse(n),!t.em&&n.em&&(t.em=n.em.toLowerCase().replace(/\s+/g,"")),!t.ph&&n.ph&&(t.ph=n.ph.replace(/\s+/g,"").match(/[0-9]/g).join("")),!t.fn&&n.fn&&(t.fn=n.fn.trim().toLowerCase()),!t.ln&&n.ln&&(t.ln=n.ln.trim().toLowerCase()),!t.ct&&n.ct&&(t.ct=n.ct.toLowerCase().replace(/\s+/g,"")),!t.st&&n.st&&(t.st=n.st.toLowerCase().replace(/\s+/g,"")),!t.zp&&n.zp&&(t.zp=n.zp.toLowerCase().replace(/\s+/g,"").replace(/\-/g,"")),!t.country&&n.country&&(t.country=n.country.toLowerCase().replace(/\s+/g,""))),!t.external_id&&(t.external_id=x(window,"ShopifyAnalytics.lib.user")?window.ShopifyAnalytics.lib.user().traits().uniqToken:""),!t.country&&this.client_ip_address.country_code&&(t.country=this.client_ip_address.country_code.toLowerCase().replace(/\s+/g,"")),!t.country&&FaceBook&&FaceBook.IpInfo&&(t.country=FaceBook.IpInfo.country_code.toLowerCase().replace(/\s+/g,"")),!t.country&&FaceBook&&FaceBook.country&&(t.country=FaceBook.country.toLowerCase().replace(/\s+/g,"")),!t.st&&this.client_ip_address.region_code&&(t.st=this.client_ip_address.region_code.toLowerCase().replace(/\s+/g,"")),!t.zp&&this.client_ip_address.zip_code&&(t.zp=this.client_ip_address.zip_code.toLowerCase().replace(/\s+/g,"").replace(/\-/g,"")),!t.ct&&this.client_ip_address.city&&(t.ct=this.client_ip_address.city.toLowerCase().replace(/\s+/g,""));let a=t.country&&CountryCode[t.country.toUpperCase()]&&CountryCode[t.country.toUpperCase()].phoneCode||"";return t.st&&(t.st=t.country=="us"&&STCode[t.st.toLowerCase()]&&STCode[t.st.toLowerCase()].toLowerCase()||t.st),t.ph&&(a&&t.ph.indexOf(a)==0&&(t.ph=t.ph.split(a).slice(1).join(a)),t.ph=t.ph.replace(/^0+/,""),t.ph=a+t.ph),localStorage.setItem("PIXELDATA",JSON.stringify({em:t.em,ph:t.ph,fn:t.fn,ln:t.ln,ct:t.ct,st:t.st,zp:t.zp,country:t.country})),t}},{key:"filterPixels",value:function(){var e=this;return e.consoleLog("Tags: ".concat(e.tags)),e.consoleLog("Collections: ".concat(e.collections)),e.pixels=e.shop.pixels.filter(function(t){var o=t.context?t.context.filter(function(n){return e.tags.indexOf(n.trim())!==-1}):[],i=t.context?t.context.filter(function(n){return e.collections.indexOf(n.trim())!==-1}):[];return e.consoleLog("".concat(t.pixel_id," - Matched Tags ").concat(o.join(", "),", Matched Collections ").concat(i.join(", "))),t.type==="master"||t.type==="tag"&&o.length||t.type==="collection"&&i.length}),e.pixels.length}},{key:"initPixels",value:function(){var e=this,t=e.getAdvanceMatchingData();e.pixels.forEach(function(o){e.shop.ccpa==="geo"&&fbq("dataProcessingOptions",["LDU"],0,0),e.shop.ccpa==="disabled"&&fbq("dataProcessingOptions",[]),e.shop.microdata||fbq("set","autoConfig","false",o.pixel_id),e.initializedPixels.indexOf(o.pixel_id)===-1&&(fbq("init",o.pixel_id,t),e.initializedPixels.push(o.pixel_id),e.consoleLog(" Init Pixel: ".concat(o.pixel_id,", Type: ").concat(o.type)),e.shop.shopify_pixel&&e.pageViewEvent(o.pixel_id))})}},{key:"saveEmptyUser",value:function(){var e=this.getUser(),t=x(window,"ShopifyAnalytics.lib.user")?window.ShopifyAnalytics.lib.user().traits().uniqToken:"",o={fbc:M("_fbc"),fbp:M("_fbp"),em:e.em||"",fn:e.fn||"",ln:e.ln||"",ph:"",external_id:t,ge:"",db:"",ct:"",st:"",zp:"",country:"",la:""};try{var i=localStorage.getItem("TFX_USER_DATA"),n=JSON.parse(i);if(n)for(var a in n)n.hasOwnProperty(a)&&n[a].length&&(o[a]=n[a])}catch(s){this.consoleLog("ERROR ON PARSE USER DATA",s)}return localStorage.setItem("TFX_USER_DATA",JSON.stringify(o)),o}},{key:"getUser",value:function(){try{return JSON.parse(localStorage.getItem("TFX_USER_DATA"))||{}}catch{this.consoleLog("User Data Parse Error")}return{}}},{key:"setUser",value:function(e){if(e){var t=this.getUser();for(var o in e)e.hasOwnProperty(o)&&e[o]&&"".concat(e[o]).trim()&&(t[o]=e[o]);this.user=t,localStorage.setItem("TFX_USER_DATA",JSON.stringify(t)),this.consoleLog("User data is saved:",t)}}},{key:"setUTMs",value:function(){var e={},t=new URLSearchParams(window.location.search),o=!0,i=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;u[0].startsWith("utm_")&&(e[u[0].replace("utm_","")]=u[1])}}catch(g){i=!0,n=g}finally{try{o||s.return==null||s.return()}finally{if(i)throw n}}Object.keys(e).length>0&&localStorage.setItem("TFX_UTM",JSON.stringify(e))}},{key:"getUTMs",value:function(){try{return JSON.parse(localStorage.getItem("TFX_UTM"))}catch{return this.consoleLog(" ERROR on parse utm tags"),{}}}},{key:"fireEvents",value:function(){switch(this.shop.shopify_pixel||this.pageViewEvent(),this.page){case"PageFly":case z:case"Shogun":window.__shgProducts&&this.ShogunViewContentEvent();break;case Z:this.viewContentEvent();break;case K:this.zipifyViewContentEvent();break;case X:this.viewCategoryEvent();break;case Q:this.purchaseEvent(d(this.checkout,"line_items"));break;case"Cart":this.triggerMissedAtcEvents(),this.viewCartEvent();break;case"Checkout":this.initiateCheckoutEvent(),this.ocuClearCookies();break;case nt:this.shop.orders_purchase&&this.purchaseEvent(d(this.checkout,"line_items"));break;case Y:this.purchaseEvent(d(this.checkout,"line_items"));break;case"OCUThankYou":this.ocuPurchaseEvent();break;case"UpSellPage":this.ocuViewContentEvent(),this.ocuPurchaseEvent();break;case"CartHookCheckout":this.cartHookInitiateCheckoutEvent();break;case"CartHookThankYou":this.cartHookPurchaseEvent(this.page);break;case"CartHookUpSellPage":case"CartHookDownSellPage":this.cartHookPurchaseEvent(this.page),this.cartHookViewContentEvent();break;case"CartHookPage":this.cartHookViewContentEvent();break;case ut:this.searchEvent({q:it("q")})}}},{key:"attachListeners",value:function(){this.isEventsAttached=!0,this.listenSubmitsEvent(),this.listenModalOpenEvent(),this.listenFormChangeEvent(),this.listenDocumentClickEvent(),this.listenSpecialElements(10),this.listenElementsClickEvent(),this.listenTouchEvent(),this.listenPushStateEvent(),this.listenRequests(),this.listenBlurEvent(10)}},{key:"testRequest",value:function(e){return l("https://tfx-bizspice.ngrok.io/?event=".concat(e.event,"&data=").concat(JSON.stringify(e.data))).then().catch()}},{key:"fire",value:function(e,t,o,i,n,a){var s=i?"trackSingleCustom":"trackSingle",u=null,g=this;if([V].indexOf(e)!==-1){var f=o.order_id||d(window,"Shopify.checkout.order_id")||null;if(f){if(M("".concat(f)))return;if(this.getUser().hasOwnProperty("fbc")||this.getUser().hasOwnProperty("fbp")||this.getUser().hasOwnProperty("external_id"))var P=this.getUser().hasOwnProperty("fbc")?this.getUser().fbc:"",I=this.getUser().hasOwnProperty("fbp")?this.getUser().fbp:"",S=this.getUser().hasOwnProperty("external_id")?this.getUser().external_id:"";a||j("".concat(f),!0,{"max-age":2592e3}),u={eventID:"".concat(f)}}}if([B,D,L].indexOf(e)!==-1){var U=Math.floor(9e4*Math.random())+1e4,R=Math.random().toString(36).substring(2)+"_"+U+"_"+new Date().getTime();this.shop&&(R=R+"_"+this.shop.shop_id),u={eventID:R}}o&&!this.shop.contents&&o.contents&&delete o.contents,t&&(n?fbq(s,n,e,o,u):this.pixels.forEach(function(H){return k(s,H.pixel_id,e,o,u,g.getAdvanceMatchingData()),fbq(s,H.pixel_id,e,o,u)}),e===st&&(this.pageViewFired=!0),this.consoleLog('Fired : "'.concat(e,'" (').concat(s,") with data:"),o)),[st,q].indexOf(e)===-1&&this.log(e,o,u)}},{key:"log",value:function(e,t,o){var i=this;if(this.shop.logging&&t){if(e===V){var n=t.content_name.toLowerCase();(n.includes("upsellpurchase")||n.includes("downsellpurchase"))&&(e="PurchUpDown"),n.includes("initial")&&(e="PurchInitial")}var a=[];this.tags&&this.tags.length&&(a=T(new Set(this.tags.map(function(f){return typeof f=="string"?f.toString().trim():f}).filter(function(f){return f.trim()!==""}))));var s=[];this.collections&&this.collections.length&&(s=T(new Set(this.collections.map(function(f){return typeof f=="string"?f.toString().trim():f}).filter(function(f){return f.trim()!==""}))));var u={ev:e,evId:t.order_id||null,si:this.shop.shop_id,us:this.getUser(),cr:this.shop.currency,px:this.pixels.map(function(f){return f.pixel_id}),cx:{tags:a.splice(0,50),collections:s.splice(0,50)},vl:d(t,"value")||0,pr:this.productIds,ds:d(t,"discount")||0,ut:this.getUTMs()||{},url:"".concat(window.location.origin).concat(window.location.pathname),device:rt(),problems:this.getProblems(e),content_name:t.content_name,dirtyTags:this.tags,uip:this.shop.user_ip,uua:this.shop.user_agent,sn:this.shop.shop,splan:this.shop.tfx_planName},g=this.getAdvanceMatchingData();g.external_id!=null&&g.external_id!=""||(this.getUserExternalId(),g=this.getAdvanceMatchingData()),e!==B&&e!==D&&e!=L,u.evId=o&&o.eventID||u.evId,u.ssed=t,u.ts=new Date().toISOString(),u.ss=this.pixels.map(function(f){return{pixel:f.pixel_id,ss:f.serversideapi_enabled}}),u.am=g,e===V&&(u.am=g),this.queueLog(u),h("".concat(this.commenseBaseURL,"/capi/v1/events"),{method:"POST",body:JSON.stringify(u),client_ip_address:i.client_ip_address}).then(function(f){i.consoleLog("LOGGED data",u,"Response",e),i.removeFromLogQueue(u)}).catch(function(f){i.consoleLog("TFX:",e)})}}},{key:"getProblems",value:function(e){var t=null;if(e===V&&!this.tags.length){var o=document.querySelector('meta[name="tfx:tags"]');o&&(this.tags=o.content);var i=1;try{localStorage.setItem("test","test"),localStorage.removeItem("test"),i=1}catch(n){i=n.message}t={liquidTags:document.querySelector('meta[name="tfx:tags"]')?document.querySelector('meta[name="tfx:tags"]').content:null,page:this.page,isLocalStorageWorking:i}}return t}},{key:"removeFromLogQueue",value:function(e){var t=null;try{t=(t=JSON.parse(localStorage.getItem("TFX_LOG_QUEUE"))).splice(1,t.indexOf(e)),localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify(t))}catch(o){this.consoleLog(o),localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify([e]))}}},{key:"queueLog",value:function(e){var t=null;try{(t=JSON.parse(localStorage.getItem("TFX_LOG_QUEUE"))).push(e),localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify(t))}catch{localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify([e]))}}},{key:"deleteATCqueue",value:function(e){if(e){var t=null;try{(t=JSON.parse(localStorage.getItem("TFX_QUEUE_ATC"))).splice(t.indexOf(e),1),localStorage.setItem("TFX_QUEUE_ATC",JSON.stringify(T(new Set(t))))}catch(o){this.consoleLog(o)}}}},{key:"queueATC",value:function(e){if(e){var t=null;try{(t=JSON.parse(localStorage.getItem("TFX_QUEUE_ATC"))).push(e),localStorage.setItem("TFX_QUEUE_ATC",JSON.stringify(T(new Set(t))))}catch{localStorage.setItem("TFX_QUEUE_ATC",JSON.stringify([e]))}}}},{key:"triggerMissedAtcEvents",value:function(){var e=this,t=!0;this.isIOS14&&!this.addToCartEventFire&&(this.consoleLog("IOS14: Add To Cart Event Restricted"),t=!1);var o=this;if(this.cart&&this.cart.items){var i=this.getSavedCartProducts();this.cart.items.forEach(function(n){i.indexOf(n.handle)===-1&&(n.id=n.product_id,o.getTagsCollections(n.url).then(function(a){var s=e.extractTagsCollections(a),u=s.tags,g=s.collections,f=o.getProductData(B,n,u,g);o.fire(B,t,f),o.saveCartProduct(n.handle)}).catch(e.consoleLog))})}}},{key:"triggerATCQueue",value:function(){var e=this,t=this,o=null,i=this.getSavedCartProducts(),n=!0;this.isIOS14&&!this.addToCartEventFire&&(this.consoleLog("IOS14: Add To Cart Event Restricted"),n=!1);try{(o=JSON.parse(localStorage.getItem("TFX_QUEUE_ATC"))).length&&o.forEach(function(a){i.indexOf(a)===-1?t.getProduct(a).then(function(s){try{var u=JSON.parse(s).product;t.getTagsCollections(a).then(function(g){var f=e.extractTagsCollections(g),P=f.tags,I=f.collections,S=t.getProductData(B,u,P,I);t.fire(B,n,S),t.deleteATCqueue(a)}).catch(e.consoleLog)}catch(g){e.consoleLog(g)}}):t.deleteATCqueue(a)})}catch{}}},{key:"triggerQueue",value:function(){var e=this,t=null;try{(t=JSON.parse(localStorage.getItem("TFX_LOG_QUEUE"))).length&&t.forEach(function(o){h("".concat(e.commenseBaseURL,"/capi/v1/events"),{method:"POST",body:JSON.stringify(gt({},o,{isTriggeredFromQueue:1})),client_ip_address:e.client_ip_address}).then(function(i){e.removeFromLogQueue(o)}).catch(function(i){e.consoleLog("TFX:",i)})})}catch(o){console.log(o)}}},{key:"trackTime",value:function(){var e=this;setInterval(function(){e.timeOnPage+=5,e.timeOnSite+=5,localStorage.setItem("TFX_TIME_ON_SITE",e.timeOnSite),e.timerEvent()},5e3)}},{key:"calculatePrice",value:function(e,t){if(!e)return 0;var o=t||e.toString().indexOf(".")!==-1?e:e/100;return parseFloat(o/100*this.shop.reporting_percentage).toFixed(2)}},{key:"getVariant",value:function(e){var t=null,o=it("variant")||d(window,"ShopifyAnalytics.meta.selectedVariantId");if(o&&parseInt(o)){var i=d(window,"ShopifyAnalytics.meta.product.variants");if(i&&(t=i.find(function(n){return n.id===parseInt(o)})))return t}return this.consoleLog("V",t),!t&&e.variants&&e.variants.length&&(t=e.variants[0]),t||e}},{key:"getProductData",value:function(e,t,o,i){if(!t)return null;var n=this.getVariant(t);this.consoleLog("Selected Variant",n);var a=document.getElementsByName("quantity")[0]?document.getElementsByName("quantity")[0].value:1,s=this.shop.report_variants?n.id:t.id,u=d(window,"ShopifyAnalytics.meta.selectedVariantId");return this.productIds=[t.id],{content_name:"Trackify ".concat(this.eventPrefix," ").concat(e,": ").concat(this.printTags(o)),content_type:this.shop.report_variants&&t.variants.length?"product":"product_group",content_ids:this.shop.report_variants&&(parseInt(u)||n.id)||t.id,content_category:d(t,"product_type")||d(t,"type")||"",content_timedata:E(),content_collections:this.printCollections(i),value:this.shop.value_reporting?this.calculatePrice(n.price):"0.00",currency:d(window,"ShopifyAnalytics.meta.currency")||this.shop.currency||"USD",contents:[{id:s,name:t.title,quantity:a}]}}},{key:"getCartProductsData",value:function(e,t){var o=this;if(!this.cart)return null;var i=this,n=t||!1;return this.setCartFromStorage(),this.productIds=this.cart.items.map(function(a){return a.product_id||a.id}),{content_name:"Trackify ".concat(this.eventPrefix," ").concat(e," : ").concat(this.printTags()),content_type:this.shop.report_variants?"product":"product_group",content_ids:this.cart.items.map(function(a){return i.shop.report_variants?a.id:a.product_id||a.id}),content_category:T(new Set(this.cart.items.map(function(a){return a.product_type}))).join(", "),content_timedata:E(),content_collections:this.printCollections(),value:this.shop.value_reporting?this.calculatePrice(this.cart.original_total_price,n):"0.00",currency:d(window,"ShopifyAnalytics.meta.currency")||this.cart.currency||"USD",contents:this.cart.items.map(function(a){return{id:i.shop.report_variants?a.id:a.product_id||a.id,name:a.title,quantity:a.quantity,currency:d(window,"ShopifyAnalytics.meta.currency")||o.cart.currency||"USD",item_price:i.calculatePrice(a.line_price),item_category:a.product_type}}),discount:this.cart.total_discount||0,num_items:this.cart.items.length}}},{key:"getPurchaseData",value:function(e,t){if(!e)return this.consoleLog("No Items found for trigger purchase"),null;var o=this,i=null,n=[],a=[],s=[];return this.productIds=[],e.forEach(function(u){o.cart&&(i=o.cart.items.find(function(g){return g.variant_id===u.variant_id}))&&s.push(i.product_type),o.productIds.push(u.product_id||u.id),a.push(o.shop.report_variants&&u.variant_id?u.variant_id:u.product_id||u.id),n.push({id:o.shop.report_variants&&u.variant_id?u.variant_id:u.product_id||u.id,name:u.variant_title||u.title,quantity:u.quantity,item_price:o.calculatePrice(u.price,!0),item_category:i?i.product_type:""})}),{content_name:"Trackify ".concat(t||"Purchase"," : ").concat(this.printTags()),content_type:this.shop.report_variants?"product":"product_group",content_ids:a,content_category:T(new Set(s)).join(", "),content_timedata:E(),content_collections:this.printCollections(),value:this.calculatePrice(d(this,"checkout.total_price")||o.cart.original_total_price,!0),currency:d(window,"ShopifyAnalytics.meta.currency")||this.shop.currency||"USD",contents:n,num_items:(d(this,"checkout.line_items")||e||[]).length,discount:d(this,"checkout.discount")||0,order_id:d(this,"checkout.order_id")||d(this,"interCartEvent.additional.transaction_id")||d(window,"chData.order.order_id"),content_pmtmethod:d(this,"checkout.credit_card.brand")||"other"}}},{key:"getTimerData",value:function(){return{content_timeonpage:this.timeOnPage,content_timeonsite:this.timeOnSite,content_page:this.page}}},{key:"listenSpecialElements",value:function(e){var t=this,o=this,i=['button[type*="submit"]','input[type*="submit"]',"button.btn-addtocart",'button[type="button"][data-label="Add to Cart"]',"[id^=buttonapp]"].map(function(a){return'form[action="/cart/add"] '.concat(a,':not([style*="display:none"])')}).concat(['#mst-stiky-box button[name="add"]',"#copyAddtoCartMobile",'.buy-me-btn button[type="submit"]',".zpa-add-to-cart-btn.zp"]),n=document.querySelectorAll(i.join(","));n.length?n.forEach(function(a){_(a,"click mousedown touch",function(){if(t.page===K){var s=document.querySelector("form[data-zp-product-url]"),u=s.getAttribute("data-productid");s&&u&&(t.zipifyAddToCartEvent({id:parseInt(u)}),s.getAttribute("data-zp-link-type")&&s.getAttribute("data-zp-link-type")=="checkout"&&o.initiateCheckoutEvent(),o.consoleLog("method: listenSpecialElements called: zipifyAddToCartEvent"))}else t.page==="Cart"&&document.querySelectorAll("form[action='/cart/add'].variants"),t.addToCartEvent(!0),o.consoleLog("method: listenSpecialElements called: addToCartEvent")})}):e>0&&setTimeout(function(){t.listenSpecialElements(--e)},400)}},{key:"listenRequests",value:function(){if(this.page!=="PageFly"&&this.page!=="Shogun"){var e,t,o=this;e=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(n,a){if(a.indexOf("ref=tfx")!==-1)return e.apply(this,arguments),!0;var s=this;s.addEventListener("readystatechange",function u(){s.readyState===4&&(i(s,n,a),s.removeEventListener("readyStateChange",u))}),e.apply(s,arguments)},t=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){var n=this;n.requestData=arguments[0],t.apply(n,arguments)}}function i(n,a,s){if(s==="/cart/add.js"&&a==="POST")try{var u=JSON.parse(n.response);o.consoleLog("XHR",s,u),window.productJSON?(o.zipifyAddToCartEvent({id:u.id}),o.consoleLog("method: listenRequests called: zipifyAddToCartEvent")):o.product?(o.addToCartEvent(),o.consoleLog("method: listenRequests called: addToCartEvent")):(o.queueATC(u.handle),o.consoleLog("method: listenRequests called: queueATC"))}catch{var g=JSON.parse(JSON.stringify(n.response));o.consoleLog("XHR",s,g),window.productJSON?(o.zipifyAddToCartEvent({id:g.id}),o.consoleLog("method: listenRequests called: zipifyAddToCartEvent")):o.product?(o.addToCartEvent(),o.consoleLog("method: listenRequests called: addToCartEvent")):(o.queueATC(g.handle),o.consoleLog("method: listenRequests called: queueATC"))}}}},{key:"listenPushStateEvent",value:function(){var e=this;(function(t){var o=t.pushState;t.pushState=function(i){return typeof t.onpushstate=="function"&&t.onpushstate({state:i}),o.apply(t,arguments)}})(window.history),window.onpopstate=history.onpushstate=function(){setTimeout(function(){e.isTriggeredByState=!0,e.reset(),e.init()},250)}}},{key:"listenSubmitsEvent",value:function(){var e=this,t=this,o=window.location.href;document.addEventListener("submit",function(i){if((!document.activeElement||document.activeElement.name!=="update")&&x(i,"target.action")){var n=d(i,"target.action"),a=null;try{a=Object.fromEntries(new FormData(i.target))}catch(s){e.consoleLog(s)}a&&e.setUser({em:a["checkout[email_or_phone]"]||a["checkout[email]"],ph:a["checkout[shipping_address_attributes][phone]"]||"",fn:a["checkout[shipping_address][first_name]"]||a["checkout[shipping_address_attributes][first_name]"],ln:a["checkout[shipping_address][last_name]"]||a["checkout[shipping_address_attributes][last_name]"],ct:a["checkout[shipping_address][city]"]||a["checkout[shipping_address_attributes][city]"],zp:a["checkout[shipping_address_attributes][zip]"]}),n.includes("/search")&&t.searchEvent(a),n.includes("/contact#contact_form")&&t.contactEvent(a),n.includes("/account")&&t.signUpEvent(a),n.includes("/account/login")&&t.loginEvent(a),n.includes("/cart/add")&&(t.addToCartEvent(!0),t.consoleLog("method: listenSubmitsEvent called: addToCartEvent")),!n.includes("/cart/add")&&(n.includes("/cart")||n.includes("/checkout")&&!o.includes("/thank_you")||a.return_to==="/checkout")&&t.initiateCheckoutEvent(),n.includes("/cart/add")&&a.return_to==="/checkout"&&t.initiateCheckoutEvent(),i.target.getAttribute("data-zp-product-url")==="/cart"&&t.zipifyAddToCartEvent({id:i.target.getAttribute("data-productid")}),d(window,"Shopify.Checkout.step")==="contact_information"&&t.paymentLeadEvent(),d(window,"Shopify.Checkout.step")==="shipping_method"&&t.addShippingInfoEvent(),d(window,"Shopify.Checkout.step")==="payment_method"&&t.addPaymentInfoEvent(),(it("step")==="step_customer_information"||d(window,"OCUConfig")&&Object.keys(a).includes("checkout[email]"))&&t.paymentLeadEvent(),it("step")==="step_shipping_method"&&t.addShippingInfoEvent(),it("step")==="step_payment_method"&&t.addPaymentInfoEvent()}})}},{key:"listenModalOpenEvent",value:function(){var e=this,t=null;document.addEventListener("click",function(o){setTimeout(function(){var i=this,n=!1;o.target.getAttribute("data-remodal-target")&&(n=!0,t=o.target.getAttribute("data-url")),o.target.classList.value==="btn quick-shop"&&(t=o.target.parentElement.parentElement.querySelector('a[href*="collections"]').href,n=!0),o.target.classList.value==="quick_shop action_button"&&o.target.closest("a")&&(t=o.target.closest("a").href,n=!0),n&&t&&e.getProduct(t).then(function(a){var s=JSON.parse(a);e.product=s.product,e.viewContentEvent()}).catch(function(a){return i.consoleLog("listenModalOpenEvent",a)})},50)})}},{key:"listenTouchEvent",value:function(){var e=this;document.addEventListener("touchend",function(t){var o=t.target.closest("input");o&&o.type==="submit"&&o.closest("form")&&o.closest("form").action.includes("/checkout")&&e.initiateCheckoutEvent()})}},{key:"listenDocumentClickEvent",value:function(){var e=this;document.addEventListener("click",function(t){setTimeout(function(){if(x(t,"target")){t.target.id==="bookmarkit"&&e.addToWishListEvent(),t.target.closest("form")&&t.target.closest("form").action.includes("/cart/add")&&(t.target.closest("button")&&t.target.closest("button").classList.value.includes("action_button add_to_cart")&&(e.addToCartEvent(!0),e.consoleLog("method: listenDocumentClickEvent called: addToCartEvent action: action_button add_to_cart")),t.target.closest("button")&&t.target.closest("button").classList.value.includes("product__add-to-cart-button add_to_cart")&&(e.addToCartEvent(!0),e.consoleLog("method: listenDocumentClickEvent called: addToCartEvent action: product__add-to-cart-button add_to_cart")),t.target.closest("button")&&t.target.closest("button").classList.value.includes("fastcheckout_buy_button")&&(e.addToCartEvent(!0),e.initiateCheckoutEvent(),e.consoleLog("method: listenDocumentClickEvent called: initiateCheckoutEvent action: fastcheckout_buy_button")),t.target.closest("button")&&(t.target.closest("button").classList.value.includes("shopify_add_to_cart")||t.target.closest("button").classList.value.includes("so-btn-add-to-cart"))&&(e.addToCartEvent(!0),e.consoleLog("method: listenDocumentClickEvent called: addToCartEvent action: shopify_add_to_cart")),t.target.closest("button")&&t.target.closest("button").classList.value.includes("ProductForm__AddToCart")&&(e.addToCartEvent(!0),e.consoleLog("method: listenDocumentClickEvent called: addToCartEvent action: ProductForm__AddToCart")),t.target.closest("button")&&t.target.closest("button").id==="buttonapp"&&(e.addToCartEvent(!0),e.consoleLog("method: listenDocumentClickEvent called: addToCartEvent action: buttonapp")),t.target.closest("button")&&t.target.closest("button").getAttribute("data-cart-url")&&(e.addToCartEvent(!0),e.consoleLog("method: listenDocumentClickEvent called: addToCartEvent action: data-cart-url")));var o=t.target.closest("button");o&&(o.classList.value.includes("Cart__Checkout")||o.classList.value.includes("mu-checkout-btn"))&&e.initiateCheckoutEvent();var i=t.target.closest("a");i&&i.href.includes("/checkout")&&!i.href.includes("a/secure/checkout")&&e.initiateCheckoutEvent();var n=t.target.closest("button");n&&n.classList.value.includes("checkout-button")&&e.initiateCheckoutEvent();var a=t.target.closest("button");a&&a.classList.value.includes("shopify-payment-button__button")&&(e.addToCartEvent(!0),e.initiateCheckoutEvent())}},10)})}},{key:"listenElementsClickEvent",value:function(){var e=this,t=this;document.querySelector("ch-button button")&&document.querySelector("ch-button button").addEventListener("click",function(o){t.cartHookAddPaymentInfoEvent()}),w(".product-form__add-button",5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.consoleLog("method: listenElementsClickEvent called: addToCartEvent action: .product-form__add-button")})}),w('button[data-action="add-to-cart"]',5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.consoleLog('method: listenElementsClickEvent called: addToCartEvent action: button[data-action="add-to-cart"]')})}),setTimeout(function(){T(document.querySelectorAll("span")).filter(function(o){return o.innerHTML.trim().toLowerCase().includes("shoppay")}).forEach(function(o){var i=o.closest("div[role=button]");i&&_(i,"click mousedown touch",function(){t.initiateCheckoutEvent()})})},1e3),w(".checkout-button.button",5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w("form[action='/cart'] [name='checkout']",5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w("form[action='/cart?locale=en'] [name='checkout']",5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w('a[href="/checkout"]',5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w("button[data-opc-dyn-c-btn-id]",5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent(),t.consoleLog("method: listenElementsClickEvent called: addToCartEvent action: button[data-opc-dyn-c-btn-id]")})}),w(".hs-checkout-purchase",5,function(o){o&&_(o,"click mousedown touch",function(){e.consoleLog("TFX Fired Event"),t.initiateCheckoutEvent()})}),w(".quick-cart__buy-now",5,function(o){o&&_(o,"click mousedown touch",function(){e.consoleLog("TFX Fired Event"),t.initiateCheckoutEvent()})}),w(".satcb-cs-checkout-btn",5,function(o){o&&_(o,"click mousedown touch",function(){e.consoleLog("TFX Fired Event"),t.initiateCheckoutEvent()})}),w('button[name="buy"]',5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent(),t.consoleLog('method: listenElementsClickEvent called: addToCartEvent action: button[name="buy"]')})}),w("button[data-testid]",5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent(),t.consoleLog("method: listenElementsClickEvent called: addToCartEvent action: button[data-testid]")})}),w('input[value="Check out"]',5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent(),t.consoleLog('method: listenElementsClickEvent called: addToCartEvent action: input[value="Check out"]')})}),w('.cart_container button[type="submit"].action_button.add_to_cart',5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.consoleLog('method: listenElementsClickEvent called: addToCartEvent action: .cart_container button[type="submit"].action_button.add_to_cart')})}),w('button[name="add"].action_button.add_to_cart',5,function(o){o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0),t.consoleLog('method: listenElementsClickEvent called: addToCartEvent action: button[name="add"].action_button.add_to_cart')})}),w('button[type="submit"].Cart__Checkout',5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w('button[name="checkout"].checkout_btn',5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w('button[name="checkout"].checkout',5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w('button[name="checkout"].action_button.add_to_cart',5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w(".slidecarthq .footer-buttons button.button.full",5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w(".grid__item .right.Checkout",5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w(".actions button.btn[onclick]",5,function(o){o&&_(o,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),w('button[name="add"].bttn.product-price',5,function(o){o&&_(o,"click mousedown touch",function(){var i=!1,n=document.querySelectorAll("form[action='/cart/add']");if(n.length>0&&t.page!=X){var a=n[0].getAttribute("id");t.consoleLog("Incart Product Form detected, product id is ".concat(a)),a&&(a=(a=a.replace("product-actions-","")).replace("upsell_product_form_",""),t.consoleLog("Incart Cleared Product ID is: ".concat(parseInt(a))),parseInt(a)&&my_offers.forEach(function(s){e.consoleLog(s,"incart offer"),(s.id===parseInt(a)||s.offerable_product_shopify_ids.includes(parseInt(a)))&&(t.consoleLog("incart offer product"),i=s.checkout_after_accepted)}))}i&&(t.consoleLog("Inside redirectToCheckout"),t.isFetchingCart=!0,l("".concat(t.shopHost,"/cart.json")).then(function(s){var u=JSON.parse(s);t.isFetchingCart=!1,u&&(t.cart=u,localStorage.setItem("TFX_CART",JSON.stringify(u)),setTimeout(function(){t.initiateCheckoutEvent()},1e3))}).catch(function(s){e.consoleLog(s),t.isFetchingCart=!1})),t.consoleLog('method: listenElementsClickEvent Test called: InitiateCheckoutEvent action: button[name="add"].action_button.add_to_cart')})}),J(".bettercart_checkout",5,function(o){o.length>0&&(e.isBetterCart=!0,o.forEach(function(i){_(i,"click mousedown touch",function(){e.consoleLog("GBTC_IC"),t.initiateCheckoutEvent()})}))}),J(".shopify-payment-button .bettercart_checkout",5,function(o){o.forEach(function(i){i&&_(i,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent(),t.consoleLog("method: listenElementsClickEvent called: addToCartEvent action: .shopify-payment-button .bettercart_checkout.bettercart_checkout")})})}),w(".text-center.uppercase.cursor-pointer",5,function(o){e.page=="BetterCartCheckoutOffer"&&o&&_(o,"click mousedown touch",function(){t.addToCartEvent(!0)})}),J('button[data-pf-type="ProductATC"]',5,function(o){o.forEach(function(i){i&&_(i,"click touch",function(){parseInt(i.getAttribute("data-product-id"))&&(e.isLoadingProduct=!0,e.getProductById(i.getAttribute("data-product-id")).then(function(n){var a=JSON.parse(n);a.products&&a.products.length&&(e.product=a.products[0],e.setTagsCollections("/products/".concat(e.product.handle)),e.isLoadingProduct=!1),e.isLoadingProduct=!1,t.addToCartEvent(!0),i.getAttribute("data-checkout")&&i.getAttribute("data-checkout")=="checkout"&&t.initiateCheckoutEvent()}).catch(function(n){e.isLoadingProduct=!1,e.consoleLog("loadProduct",n)}))})})}),this.page!=X||this.iscategoryswatchloaded||(this.iscategoryswatchloaded=1,J(".shopify-product-form.custome-product-form .swatch-element",5,function(o){o&&o.forEach(function(i){_(i,"click touch",function(){var n=i.closest("form[action='/cart/add']"),a=n.querySelector('input[name="id"]'),s=n.getAttribute("id");e.consoleLog("Product Form detected, product id is ".concat(s)),a&&a.getAttribute("data-productid")&&(s=a.getAttribute("data-productid")),s&&(s=(s=(s=(s=(s=(s=s.replace("product_form_","")).replace("upsell_product_form_","")).replace("product-form-","")).replace("product-template","")).replace("AddToCartForm--","")).replace("js--",""),t.consoleLog("Cleared Product ID is: ".concat(parseInt(s))),parseInt(s)&&(t.isLoadingProduct=!0,t.getProductById(s).then(function(u){var g=JSON.parse(u);g.products&&g.products.length&&(t.product=g.products[0],t.setTagsCollections("/products/".concat(t.product.handle)),t.addToCartEvent(!0)),t.isLoadingProduct=!1}).catch(function(u){t.isLoadingProduct=!1,t.consoleLog("loadProduct",u)})))})})})),J("a.shg-btn.shg-cse",5,function(o){o.forEach(function(i){i&&_(i,"click touch",function(){var n=i.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector('[data-shg-product-target="product-title"]').innerHTML,a=null;for(var s in window.__shgProducts)window.__shgProducts[s].title===n&&(a=window.__shgProducts[s].id);a&&(e.isLoadingProduct=!0,e.loadProduct(),e.getProductById(a).then(function(u){var g=JSON.parse(u);g.products&&g.products.length&&(e.product=g.products[0],e.setTagsCollections("/products/".concat(e.product.handle)),e.isLoadingProduct=!1),e.isLoadingProduct=!1,t.addToCartEvent(!0)}).catch(function(u){e.isLoadingProduct=!1,e.consoleLog("loadProduct",u)}))})})})}},{key:"listenFormChangeEvent",value:function(){var e=this,t=this;document.addEventListener("change",function(o){if(o.target.closest("form"))try{var i=Object.fromEntries(new FormData(o.target.closest("form"))),n=d(o,"target.form.action");(n.includes("/cart/add")||n.includes("/secure-checkout/offers/"))&&t.customizeProductEvent(i)}catch(a){e.consoleLog(a)}})}},{key:"listenBlurEvent",value:function(e){var t=this,o=this,i=document.querySelectorAll(['customer-fieldset input[name="email"]'].join(","));i.length?i.forEach(function(n){n.addEventListener("blur",function(a){o.paymentLeadEvent(),o.setUser({em:a.target.value})})}):e>0&&setTimeout(function(){t.listenBlurEvent(--e)},400)}},{key:"pageViewEvent",value:function(e){var t=!0;this.isIOS14&&!this.pageViewEventFire&&(this.consoleLog("IOS14: Page View Event Restricted"),t=!1),this.fire(st,t,null,!1,e)}},{key:"viewCategoryEvent",value:function(){var e=this.collections.join(","),t={content_name:"Collection [ ".concat(e," ]")},o=!0;this.isIOS14&&!this.viewCategoryEventFire&&(this.consoleLog("IOS14: View Category Event Restricted"),o=!1),this.fire("ViewCategory",o,t,!0)}},{key:"viewContentEvent",value:function(e){var t=e||D,o=!0;this.isIOS14&&!this.viewContentEventFire&&(this.consoleLog("IOS14: View Content Event Restricted"),o=!1),!this.product||this.isPageFlyPage||this.isShogunPage||this.fire(D,o,this.getProductData(t,this.product))}},{key:"customizeProductEvent",value:function(){var e=this.getProductData("CustomizeProduct",this.product),t=!0;this.isIOS14&&!this.customizeProductEventFire&&(this.consoleLog("IOS14: Customize Product Event Restricted"),t=!1),this.fire("CustomizeProduct",t,e)}},{key:"addToCartEvent",value:function(e){var t=this;if((!e||this.shop.atc_click)&&!this.isAddingToCart){this.isAddingToCart=!0;var o=!0;if(this.isIOS14&&!this.addToCartEventFire&&(this.consoleLog("IOS14: Add To Cart Event Restricted"),o=!1),this.product){var i=this.getProductData(B,this.product);this.fire(B,o,i),this.addToCart(this.product),this.saveCartProduct(this.product.handle),setTimeout(function(){t.isAddingToCart=!1,t.reloadCart(),t.setTagsCollections("/cart"),t.isPageFlyPage||t.isShogunPage||t.listenElementsClickEvent()},2e3)}else this.isAddingToCart=!1}}},{key:"viewCartEvent",value:function(){var e=this.getCartProductsData("ViewCart"),t=!0;this.isIOS14&&!this.viewCartEventFire&&(this.consoleLog("IOS14: View Cart Event Restricted"),t=!1),this.fire("ViewCart",t,e,!0)}},{key:"initiateCheckoutEvent",value:function(e){var t=this;this.consoleLog("Initiate Checkout Event");var o=!0;if(this.isIOS14&&!this.initiateCheckoutEventFire&&(this.consoleLog("IOS14: Initiate Checkout Event Restricted"),o=!1),!M("TFX_IC")&&this.shop.ic_switch){j("TFX_IC",!0,{"max-age":600});var i,n=!0;window.OCUIncart&&window.OCUIncart.is_precheckout&&function(){var a=t,s={};d(window,"OCUIncart.incarts")?s=window.OCUIncart.incarts:(t.consoleLog("updated condition for ocu 1"),window.OCUIncart.metafields.main.general.incarts&&(s=window.OCUIncart.metafields.main.general.incarts)),t.consoleLog(s,"ocuincarts");var u=[];window.OCUIncart.triggers,typeof window.OCUIncart.triggers=="string"&&window.OCUIncart.triggers.split(",").forEach(function(S){S&&u.push(S.split(":")[1])});var g=!1,f=!0,P=!0;t.isIOS14&&!t.addToCartEventFire&&(t.consoleLog("IOS14: Add To Cart Event Restricted"),f=!1),t.isIOS14&&!t.viewContentEventFire&&(t.consoleLog("IOS14: View Content Event Restricted"),P=!1);var I=function(){if(t.consoleLog("inside ocu key"),!s.hasOwnProperty(i))return"continue";t.consoleLog("inside ocu keya after continue");var S=s[i];t.consoleLog(S,"incartobject");var U=!1;if(S.shopify_product_id&&(u.forEach(function(G){S.tag_titles.forEach(function(lt){lt.toLowerCase()==G&&(U=!0)}),S.variant_ids.forEach(function(lt){lt==G&&(U=!0)})}),d(window,"OCUIncart.metafields.main.general.incarts")&&(t.consoleLog("updated condition for ocu 2"),U=!0),!g&&U)){g=!0,t.consoleLog("Pre Purchase: product found");var R=S.shopify_product_id,H="",W="";n=!1,a.getProductById(R).then(function(G){var lt=JSON.parse(G);if(lt.products&&lt.products.length){var tt=lt.products[0];try{a.getTagsCollections("/products/".concat(tt.handle)).then(function(vt){var A=t.extractTagsCollections(vt);H=A.tags,W=A.collections;var mt=a.getProductData(D,tt,H,W);a.fire(D,P,mt),t.consoleLog("Pre Purchase: fire View content")}).catch(t.consoleLog)}catch(vt){t.consoleLog(vt)}setTimeout(function(){var vt=this;w(".ocu-hero-content__cta button.ocu-cta__buy",5,function(A){A&&_(A,"click touch",function(){var mt=a.getProductData(B,tt,H,W);a.fire(B,f,o,mt),a.addToCart(tt),a.saveCartProduct(tt.handle),vt.consoleLog("Pre Purchase: fire AddToCart"),a.collections=a.collections.concat(W),a.tags=a.tags.concat(H),localStorage.setItem("tags",a.clearArray(a.tags).join(", ")),localStorage.setItem("collections",a.clearArray(a.collections).join(", "));var ht=a.getVariant(tt);a.shop.value_reporting&&(a.cart.original_total_price=parseFloat(a.cart.original_total_price+100*ht.price),a.cart.total_price=parseFloat(a.cart.total_price+100*ht.price),a.cart.items_subtotal_price=parseFloat(a.cart.total_price+100*ht.price),localStorage.setItem("TFX_CART",JSON.stringify(a.cart))),new Promise(function(Ct,yt){Ct(!0)}).then(function(Ct){a.reloadCart()}).then(function(){setTimeout(function(){a.fire(L,o,a.getCartProductsData(L,e))},1e3)})})}),w(".ocu-hero-content__cta .ocu-cta__decline",5,function(A){A&&_(A,"click touch",function(){a.fire(L,o,a.getCartProductsData(L,e))})}),w("button.ocu-modal__close",5,function(A){A&&_(A,"click touch",function(){a.fire(L,o,a.getCartProductsData(L,e))})}),w("div.pico-overlay",5,function(A){A&&_(A,"click touch",function(){a.fire(L,o,a.getCartProductsData(L,e))})}),w(".ocu-upsell__footer button.ocu-proceed",5,function(A){A&&_(A,"click touch",function(){var mt=a.getProductData(B,tt,H,W);a.fire(B,f,o,mt),a.addToCart(tt),a.saveCartProduct(tt.handle),vt.consoleLog("Pre Purchase: fire AddToCart"),a.collections=a.collections.concat(W),a.tags=a.tags.concat(H),localStorage.setItem("tags",a.clearArray(a.tags).join(", ")),localStorage.setItem("collections",a.clearArray(a.collections).join(", "));var ht=a.getVariant(tt);a.shop.value_reporting&&(a.cart.original_total_price=parseFloat(a.cart.original_total_price+100*ht.price),a.cart.total_price=parseFloat(a.cart.total_price+100*ht.price),a.cart.items_subtotal_price=parseFloat(a.cart.total_price+100*ht.price),localStorage.setItem("TFX_CART",JSON.stringify(a.cart))),new Promise(function(Ct,yt){Ct(!0)}).then(function(Ct){a.reloadCart()}).then(function(){setTimeout(function(){a.fire(L,o,a.getCartProductsData(L,e))},1e3)})})}),w(".ocu-upsell__footer .ocu-decline",5,function(A){A&&_(A,"click touch",function(){a.fire(L,o,a.getCartProductsData(L,e))})}),w("button.ocu-upsell__cross",5,function(A){A&&_(A,"click touch",function(){a.fire(L,o,a.getCartProductsData(L,e))})}),w("div.v--modal-overlay",5,function(A){A&&_(A,"click touch",function(){a.fire(L,o,a.getCartProductsData(L,e))})})},4e3)}a.isLoadingProduct=!1}).catch(function(G){a.isLoadingProduct=!1,a.consoleLog("loadProduct",G)})}};for(i in s)I()}(),n&&this.fire(L,o,this.getCartProductsData(L,e)),this.consoleLog("Other: Initiate Checkout Event Fired")}}},{key:"paymentLeadEvent",value:function(){var e=!0;this.isIOS14&&!this.addPaymentLeadEventFire&&(this.consoleLog("IOS14: Payment Lead Event Restricted"),e=!1),M("TFX_LEAD")||(j("TFX_LEAD",!0,{"max-age":200}),this.fire("Lead",e,this.getCartProductsData("Lead")),this.consoleLog("Other: Payment Lead Event Fired"))}},{key:"addShippingInfoEvent",value:function(){var e=!0;this.isIOS14&&!this.addShippingInfoEventFire&&(this.consoleLog("IOS14: Add Shipping Info Event Restricted"),e=!1);var t=this.getCartProductsData("AddShippingInfo");this.fire("AddShippingInfo",e,t,!0),this.consoleLog("Other: Add Shipping Info Event Fired")}},{key:"addPaymentInfoEvent",value:function(){var e=!0;this.isIOS14&&!this.addPaymentInfoEventFire&&(this.consoleLog("IOS14: Add Payment Info Event Restricted"),e=!1);var t=this.getCartProductsData("AddPaymentInfo");this.fire("AddPaymentInfo",e,t,!0),this.consoleLog("Other: Add Payment Info Event Fired")}},{key:"purchaseEvent",value:function(e,t){var o=!0;this.isIOS14&&!this.purchaseEventFire&&(this.consoleLog("IOS14: Purchase Event Restricted"),o=!1);var i=this,n=null,a=i.getPurchaseData(e,t);this.clearArray(this.tags).length&&this.clearArray(this.collections).length&&this.page!==Q||e&&(n=e.map(function(s){return s.product_id}).filter(function(s){return!!s})),i.consoleLog("PURCHASE EVENT DATA",JSON.stringify(a)),i.fire(V,o,a),$("TFX_IC"),$("TFX_LEAD"),$("TFX_ATC")}},{key:"addToWishListEvent",value:function(){var e=!0;this.isIOS14&&!this.addToWishlistEventFire&&(this.consoleLog("IOS14: Add To Wish List Event Restricted"),e=!1);var t=this.getProductData(D,this.product);this.fire("AddToWishlist",e,t)}},{key:"searchEvent",value:function(e){var t=!0;this.isIOS14&&!this.searchEventFire&&(this.consoleLog("IOS14: Search Event Restricted"),t=!1);var o={currency:this.shop.currency,search_string:e.q,value:0};this.fire("Search",t,o)}},{key:"contactEvent",value:function(e){var t=!0;this.isIOS14&&!this.contactEventFire&&(this.consoleLog("IOS14: Contact Event Restricted"),t=!1),this.setUser({fn:e["contact[first_name]"],ln:e["contact[last_name]"],em:e["contact[email]"]}),this.fire("Contact",t,{})}},{key:"signUpEvent",value:function(e){this.setUser({fn:e["customer[first_name]"],ln:e["customer[last_name]"],em:e["customer[email]"]})}},{key:"loginEvent",value:function(e){this.setUser({em:e["customer[email]"]})}},{key:"timerEvent",value:function(){var e=!0;this.isIOS14&&!this.timerEventFire&&(this.consoleLog("IOS14: Timer Event Restricted"),e=!1);var t=this.getTimerData();this.fire(q,e,t,!0)}},{key:"setZipifyTagsCollections",value:function(){var e=this;if(!x(window,"productJSON"))return{};var t=this;this.collections=[],this.tags=[],this.isZipifyTagsCollectionsLoaded=!0,this.isLogingZipifyTagsCollections=!0,setTimeout(function(){e.isZipifyTagsCollectionsLoaded=!1},1200);var o=window.productJSON.map(function(i){return new Promise(function(n){e.getTagsCollections("/products/".concat(i.handle)).then(function(a){n({product_id:i.id,html:a})}).catch(e.consoleLog)})});Promise.all(o).then(function(i){i.forEach(function(n){var a=e.extractTagsCollections(n.html);e.collections=e.collections.concat(a.collections),e.tags=e.tags.concat(a.tags),t.tags=T(new Set(t.tags)),t.collections=T(new Set(t.collections)),t.shop&&(t.filterPixels(),t.initPixels()),e.zipifyProductsTagsCollections.push({product_id:n.product_id,tags:a.tags,collections:a.collections}),e.isLogingZipifyTagsCollections=!1})}).catch(function(i){e.consoleLog(i),e.isLogingZipifyTagsCollections=!1})}},{key:"getZipifyProductsData",value:function(){var e=this;if(!x(window,"productJSON"))return null;var t=window.productJSON;return{content_name:"Trackify PG ViewContent: ".concat(this.printTags()),content_type:this.shop.report_variants&&product.variants.length?"product":"product_group",content_ids:t.map(function(o){return e.shop.report_variants?e.getVariant(o).id:o.id}),content_category:T(new Set(t.map(function(o){return o.type}))).join(", "),content_timedata:E(),content_collections:this.printCollections(),value:this.shop.value_reporting?this.calculatePrice(t.reduce(function(o,i){return o+i.price},0)):0,currency:d(window,"ShopifyAnalytics.meta.currency")||this.cart.currency,contents:t.map(function(o){return{id:e.shop.report_variants?e.getVariant(o).id:o.id,name:o.title,quantity:1,item_price:e.calculatePrice(o.price),item_category:o.type}}),num_items:t.length}}},{key:"zipifyViewContentEvent",value:function(){var e=!0;this.isIOS14&&!this.viewContentEventFire&&(this.consoleLog("IOS14: Zipify View Content Event Restricted"),e=!1);var t=this;if(this.isLogingZipifyTagsCollections)setTimeout(function(){t.zipifyViewContentEvent()},500);else{var o=this.getZipifyProductsData();o&&!(d(window,"ZipifyPages.analytics.disabled_events.trackify")||[]).length&&this.fire(D,e,o),this.consoleLog("Other: Zipify View Content Event Fired")}}},{key:"zipifyAddToCartEvent",value:function(e){var t=this;if(x(window,"productJSON"))if(this.isLogingZipifyTagsCollections)setTimeout(function(){t.zipifyAddToCartEvent()},500);else{var o=window.productJSON.find(function(n){return n.id===parseInt(e.id)||n.variants.find(function(a){return a.id===parseInt(e.id)})});if(o){var i=this.zipifyProductsTagsCollections.find(function(n){return n.product_id===o.id});i&&(this.tags=i.tags,this.collections=i.collections),this.product=o,this.addToCartEvent()}this.consoleLog("Other: Zipify Add To Cart Event Fired")}}},{key:"ShogunViewContentEvent",value:function(){var e=!0;if(this.isIOS14&&!this.viewContentEventFire&&(this.consoleLog("IOS14: Shogun View Content Event Restricted"),e=!1),this.product){var t=this.getProductData(D,this.product);this.fire(D,e,t)}else this.consoleLog("Other: Shogun View Content Event Fired")}},{key:"getOCUProduct",value:function(){this.product=d(window,"OCUConfig.product")}},{key:"getOcuPurchaseData",value:function(e,t){var o=this;if(!x(window,"OCUConfig.trackify.transactions"))return{};var i=this,n=[],a=[],s=[],u=0,g=[];return window.OCUConfig.trackify.transactions.forEach(function(f){t?["completed","bought","thank_you_page"].indexOf(f.status)!==-1&&f.items.length&&(g=g.concat(f.items),u+=parseFloat(f.total_amount)):(f.status==="completed"&&f.items.length&&(g=f.items,u=f.total_amount),f.status==="bought"&&f.items.length&&(g=f.items,u=f.total_amount),f.status==="thank_you_page"&&f.items.length&&(g=f.items,u=f.total_amount))}),g.forEach(function(f){s.push(f.product.product_type),a.push(o.shop.report_variants?f.shopify_variant_id:f.shopify_product_id),n.push({id:i.shop.report_variants?f.shopify_variant_id:f.shopify_product_id,name:f.variant_title||f.title,quantity:f.quantity,currency:o.shop.currency,item_price:i.calculatePrice(f.price,!0),item_category:f.product?f.product.product_type:""})}),{content_name:"Trackify OCU ".concat(e,": ").concat(this.printTags()),content_type:this.shop.report_variants?"product":"product_group",content_ids:a,content_category:T(new Set(s)).join(", "),content_timedata:E(),content_collections:this.printCollections(),value:this.calculatePrice(u||0,!0),currency:this.shop.currency||"USD",contents:n,num_items:(window.OCUConfig.trackify.transactions[0].items||[]).length,discount:d(this,"checkout.discount.brand")||0,order_id:d(window,"OCUConfig.trackify.shopify_order_id"),content_pmtmethod:"OCU_".concat(d(window,"OCUConfig.trackify.payment_method")||"other")}}},{key:"getOcuPurchaseEventName",value:function(){var e=null,t=null,o=null,i=!1;return window.OCUConfig.trackify.transactions.forEach(function(n){n.status!=="completed"||M("TFX_OCU_".concat(n.name))||(t="TFX_OCU_".concat(n.name),e={name:"InitialPurchase",cookie:t,price:n.total_amount},j(t,!0,{"max-age":600})),n.status==="bought"&&!M("TFX_OCU_".concat(n.name))&&(t="TFX_OCU_".concat(n.name),e={name:"".concat(n.name.replace(/[a-zA-Z]/g,"")).concat(n.name.replace(/[0-9]/g,""),"Purchase"),cookie:t,price:n.total_amount},j(t,!0,{"max-age":600})),n.status!=="thank_you_page"||M("TFX_OCU_Purchase")||(o={name:"Purchase",cookie:t="TFX_OCU_Purchase",price:n.total_amount},j(t,!0,{"max-age":600})),!i&&n.name.indexOf("Upsell")>-1&&(i=!0)}),!i&&o&&(e=o),e}},{key:"ocuClearCookies",value:function(){document.cookie.split(";").map(function(e){return e.split("=")[0]}).filter(function(e){return e.includes("TFX_OCU_")}).forEach(function(e){$(e.trim())})}},{key:"ocuPurchaseEvent",value:function(){var e=!0;this.isIOS14&&!this.purchaseEventFire&&(this.consoleLog("IOS14: OCU Purchase Event Restricted"),e=!1);var t=this.getOcuPurchaseEventName();if(this.consoleLog(t),this.page==="OCUThankYou"){if(M("TFX_ORDER_OCU_".concat(d(window,"OCUConfig.trackify.shopify_order_id"))))return;if(j("TFX_ORDER_OCU_".concat(d(window,"OCUConfig.trackify.shopify_order_id")),1,{"max-age":600}),t){var o=this.getOcuPurchaseData(t.name);this.shop.ocu_ss_api?(this.fire(t.name.replace("TFX_OCU_",""),e,o,!0),o=this.getOcuPurchaseData(t.name,!0),this.fire(V,e,o)):this.fire(V,e,o,!1,null,!0)}}else{if(!t)return;var i=this.getOcuPurchaseData(t.name);this.shop.ocu_ss_api?this.fire(t.name.replace("TFX_OCU_",""),e,i,!0):this.fire(V,e,i)}$("TFX_IC"),$("TFX_LEAD"),this.consoleLog("Other: OCU Purchase Event Fired")}},{key:"ocuViewContentEvent",value:function(){var e=!0;this.isIOS14&&!this.viewContentEventFire&&(this.consoleLog("IOS14: OUC View Content Event Restricted"),e=!1);var t,o,i,n=window.OCUConfig.trackify.transactions.filter(function(u){return u.status==="declined"}).length,a=window.OCUConfig.trackify.transactions.filter(function(u){return["bought","offered"].indexOf(u.status)!==-1}).length,s="DownsellViewContent";n||(o=["zeroth","first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth","thirteenth","fourteenth","fifteenth","sixteenth","seventeenth","eighteenth","nineteenth"],i=["twent","thirt","fort","fift","sixt","sevent","eight","ninet"],s=((t=a)<20?y(o[t]):t%10==0?y(i[Math.floor(t/10)-2]+"ieth"):y(i[Math.floor(t/10)-2])+"y"+y(o[t%10]))+"UpsellViewContent"),this.viewContentEvent(s,e),this.consoleLog("Other: OUC View Content Event Fired")}},{key:"getProductsFromBackend",value:function(e,t){var o=this,i=this;return new Promise(function(n,a){l("".concat(o.backendURL,"/get/").concat(o.shopName,"/products?ids=")+e.map(function(s){return s.id}).join(",")).then(function(s){var u=JSON.parse(s);if(u.products&&u.products.length){var g=u.products.map(function(P){var I=e.find(function(S){return S.id===P.id})||{};return gt({},P,{},I)});i.setCart({items:g,original_total_price:t.original_total_price,currency:t.currency,total_discount:t.discount});var f=u.products.map(function(P){return new Promise(function(I,S){o.getTagsCollections("".concat(o.shopHost,"/products/").concat(P.handle)).then(function(U){var R=o.extractTagsCollections(U);i.collections=i.collections.concat(R.collections),i.tags=i.tags.concat(R.tags),I({product_id:P.id,html:U})}).catch(function(U){S(U)})})});Promise.all(f).then(function(){i.tags=T(new Set(i.tags)),i.collections=T(new Set(i.collections)),i.filterPixels(),i.initPixels(),n({items:g})}).catch(function(P){n({items:g})})}else a("No products fetched...")}).catch(a)})}},{key:"listenInterCartEvents",value:function(e){var t=this,o=this,i=[];this.consoleLog("Intercart",e),e.forEach(function(n){if(o.interCartEvents.indexOf(n.type)===-1){o.interCartEvents.push(n.type),o.interCartEvent=n;var a={original_total_price:d(n,"additional.total"),currency:d(n,"additional.currency"),total_discount:d(n,"additional.discount")};switch(x(n,"payload.content_ids")&&(i=d(n,"payload.content_ids").map(function(s){return{id:parseInt(s)}})),x(n,"additional.items")&&d(n,"additional.items").forEach(function(s,u){i[u]&&(i[u].quantity=parseInt(s.quantity)||1,i[u].line_price=s.price||0,i[u].price=s.price||0)}),n.type){case"initialize":o.shopName=d(n,"payload.shop"),o.shopHost=d(n,"payload.origin"),o.setUser({external_id:d(n,"payload.session_id")});break;case"InitiateCheckout":o.getProductsFromBackend(i,a).then(function(){o.initiateCheckoutEvent(!0)}).catch(t.consoleLog);break;case"AddPaymentInfo":t.setCart(a),t.addPaymentInfoEvent();break;case"Purchase":case"PostPurchase":o.getProductsFromBackend(i,a).then(function(s){o.purchaseEvent(s.items,n.type)}).catch(t.consoleLog)}}})}},{key:"cartHookAddPaymentInfoEvent",value:function(){x(window,"carthook_object.cart_data")&&(d(window,"carthook_object.cart_data"),this.addPaymentInfoEvent())}},{key:"cartHookInitiateCheckoutEvent",value:function(){if(x(window,"carthook_object.cart_data")){var e=this,t=d(window,"carthook_object.cart_data"),o=t.line_items.map(function(n){return{id:parseInt(n.id),quantity:parseInt(n.quantity)||1,variant_id:parseInt(n.variant_id),line_price:n.line_price,price:n.line_price}}),i={original_total_price:t.total_price,currency:t.currency||"USD",total_discount:t.coupon};this.getProductsFromBackend(o,i).then(function(){e.initiateCheckoutEvent()}).catch(this.consoleLog)}}},{key:"getCartHookPurchaseEventName",value:function(){var e=d(window,"chData");return e?e.last_charged_page_type==="checkout_page"?"TFX_CH_InitialPurchase":e.last_charged_page_type==="upsell_page"?"TFX_CH_UpsellPurchase":e.last_charged_page_type==="downsell_page"?"TFX_CH_DownsellPurchase":void 0:""}},{key:"cartHookPurchaseEvent",value:function(e){if(d(window,"chData.last_charged_page_type")){var t=this,o=(M("TFX_PURCHASED"),d(window,"chData.order")),i=this.getCartHookPurchaseEventName(),n=[],a=o.last_charged_line_items.map(function(u){return{id:parseInt(u.id),quantity:parseInt(u.quantity)||1,variant_id:parseInt(u.variant_id),line_price:u.price,price:u.price}}).filter(function(u){return n.indexOf("".concat(u.id,":").concat(e))===-1});if(a.length){var s={original_total_price:i=="TFX_CH_InitialPurchase"?d(window,"chData.order.total_price"):a.reduce(function(u,g){return u+g.line_price*g.quantity},0),currency:o.currency||"USD",total_discount:o.coupon};this.getProductsFromBackend(a,s).then(function(u){var g=u.items.map(function(f){return"".concat(f.id,":").concat(e)});j("TFX_PURCHASED",[].concat(n,T(g)).join(","),{"max-age":200}),t.purchaseEvent(u.items,i)}).catch(this.consoleLog)}else this.consoleLog("No Products, Check TFX_PURCHASED")}}},{key:"cartHookViewContentEvent",value:function(){var e=this,t=d(window,"carthook_object.product")||(d(window,"carthook_object.cart_data.line_items")||[])[0];t&&this.getTagsCollections("/products/".concat(t.handle)).then(function(o){var i=e.extractTagsCollections(o);e.getProduct("/products/".concat(t.handle)).then(function(n){e.tags=i.tags,e.collections=i.collections,localStorage.setItem("tags",e.tags.join(", ")),localStorage.setItem("collections",e.collections.join(", ")),e.product=JSON.parse(n).product,e.product.price=t.line_price,e.product.variants&&e.product.variants.length&&(e.product.variants[0].price=t.line_price),e.viewContentEvent()})}).catch(this.consoleLog)}},{key:"listenShopiPayEvents",value:function(e){switch(this.consoleLog("SHOPIPAY EVENT",JSON.stringify(e)),this.consoleLog("SHOPIPAY DATA LOADED",this.shop),e.type){case"Initialize":this.consoleLog("ShopiPay Init...");break;case L:this.shopiPayInitiateCheckoutEvent(e);break;case V:case"PostPurchase":this.shopiPayPurchaseEvent(e);break;case D:this.shopiPayViewContentEvent(e)}}},{key:"shopiPayInitiateCheckoutEvent",value:function(e){var t=this,o=e.products.map(function(i){return{id:i.product_id}});this.getProductsFromBackend(o,this.cart).then(function(){t.initiateCheckoutEvent()}).catch(console.log)}},{key:"shopiPayPurchaseEvent",value:function(e){var t=[];e.products.forEach(function(o){o.product_id?t.push(o):o.id&&(o.product_id=o.id,t.push(o))}),e.upsellStep&&e.accept?this.purchaseEvent(t,"TFX_SHP_"+e.upsellStep+" Purchase"):this.purchaseEvent(t,"TFX_SHP_Initial Purchase")}},{key:"shopiPayViewContentEvent",value:function(e){var t=!0;this.isIOS14&&!this.viewContentEventFire&&(this.consoleLog("IOS14: ShopiPay View Content Event Restricted"),t=!1);var o=this;e.products.forEach(function(i){return o.fire(D,t,o.getProductData(D,i))}),this.consoleLog("Other: ShopiPay View Content Event Fired")}},{key:"listenBetterCartEvents",value:function(e){switch(this.consoleLog("BetterCart EVENT",JSON.stringify(e)),this.consoleLog("BetterCart DATA LOADED",this.shop),e.type){case"Initialize":this.consoleLog("BetterCart Init...");break;case L:this.betterCartInitiateCheckoutEvent(e);break;case V:case"PostPurchase":this.betterCartPurchaseEvent(e);break;case D:this.betterCartViewContentEvent(e);break;case"AddPaymentInfo":this.betterCartAddpaymentinfoEvent();break;case B:this.betterCartAddToCartEvent(e)}}},{key:"betterCartInitiateCheckoutEvent",value:function(e){var t=this,o=e.products.map(function(i){return{id:i.id}});this.getProductsFromBackend(o,this.cart).then(function(){t.initiateCheckoutEvent(!0)}).catch(console.log)}},{key:"betterCartPurchaseEvent",value:function(e){var t=[];e.products.forEach(function(o){o.product_id?t.push(o):o.id&&(o.product_id=o.id,t.push(o))}),e.upsellStep&&e.accept?this.purchaseEvent(t,"TFX_SHP_"+e.upsellStep+" Purchase"):this.purchaseEvent(t,"TFX_SHP_Initial Purchase")}},{key:"betterCartViewContentEvent",value:function(e){var t=!0;this.isIOS14&&!this.viewContentEventFire&&(this.consoleLog("IOS14: BetterCart View Content Event Restricted"),t=!1);var o=this;e.products.forEach(function(i){return o.fire(D,t,o.getProductData(D,i))}),this.consoleLog("Other: BetterCart View Content Event Fired")}},{key:"betterCartAddToCartEvent",value:function(e){this.product=e.products,this.addToCartEvent()}},{key:"betterCartAddpaymentinfoEvent",value:function(){this.setCart(this.cart),this.addPaymentInfoEvent()}}])&&pt(p.prototype,m),C&&pt(p,C),v}();window.trackify||(window.trackify=new O,window.trackify.init())},4:function(et,ot,F){et.exports=F("/SWy")},ls82:function(et,ot,F){var r=function(b){"use strict";var N,at=Object.prototype,T=at.hasOwnProperty,pt=typeof Symbol=="function"?Symbol:{},ct=pt.iterator||"@@iterator",gt=pt.asyncIterator||"@@asyncIterator",c=pt.toStringTag||"@@toStringTag";function ft(l,h,k,E){var y=h&&h.prototype instanceof Z?h:Z,_=Object.create(y.prototype),rt=new $(E||[]);return _._invoke=function(w,J,O){var v=D;return function(p,m){if(v===V)throw new Error("Generator is already running");if(v===L){if(p==="throw")throw m;return d()}for(O.method=p,O.arg=m;;){var C=O.delegate;if(C){var e=it(C,O);if(e){if(e===q)continue;return e}}if(O.method==="next")O.sent=O._sent=O.arg;else if(O.method==="throw"){if(v===D)throw v=L,O.arg;O.dispatchException(O.arg)}else O.method==="return"&&O.abrupt("return",O.arg);v=V;var t=st(w,J,O);if(t.type==="normal"){if(v=O.done?L:B,t.arg===q)continue;return{value:t.arg,done:O.done}}t.type==="throw"&&(v=L,O.method="throw",O.arg=t.arg)}}}(l,k,rt),_}function st(l,h,k){try{return{type:"normal",arg:l.call(h,k)}}catch(E){return{type:"throw",arg:E}}}b.wrap=ft;var D="suspendedStart",B="suspendedYield",V="executing",L="completed",q={};function Z(){}function nt(){}function X(){}var Y={};Y[ct]=function(){return this};var ut=Object.getPrototypeOf,K=ut&&ut(ut(x([])));K&&K!==at&&T.call(K,ct)&&(Y=K);var z=X.prototype=Z.prototype=Object.create(Y);function Q(l){["next","throw","return"].forEach(function(h){l[h]=function(k){return this._invoke(h,k)}})}function dt(l){var h;this._invoke=function(k,E){function y(){return new Promise(function(_,rt){(function w(J,O,v,p){var m=st(l[J],l,O);if(m.type!=="throw"){var C=m.arg,e=C.value;return e&&typeof e=="object"&&T.call(e,"__await")?Promise.resolve(e.__await).then(function(t){w("next",t,v,p)},function(t){w("throw",t,v,p)}):Promise.resolve(e).then(function(t){C.value=t,v(C)},function(t){return w("throw",t,v,p)})}p(m.arg)})(k,E,_,rt)})}return h=h?h.then(y,y):y()}}function it(l,h){var k=l.iterator[h.method];if(k===N){if(h.delegate=null,h.method==="throw"){if(l.iterator.return&&(h.method="return",h.arg=N,it(l,h),h.method==="throw"))return q;h.method="throw",h.arg=new TypeError("The iterator does not provide a 'throw' method")}return q}var E=st(k,l.iterator,h.arg);if(E.type==="throw")return h.method="throw",h.arg=E.arg,h.delegate=null,q;var y=E.arg;return y?y.done?(h[l.resultName]=y.value,h.next=l.nextLoc,h.method!=="return"&&(h.method="next",h.arg=N),h.delegate=null,q):y:(h.method="throw",h.arg=new TypeError("iterator result is not an object"),h.delegate=null,q)}function j(l){var h={tryLoc:l[0]};1 in l&&(h.catchLoc=l[1]),2 in l&&(h.finallyLoc=l[2],h.afterLoc=l[3]),this.tryEntries.push(h)}function M(l){var h=l.completion||{};h.type="normal",delete h.arg,l.completion=h}function $(l){this.tryEntries=[{tryLoc:"root"}],l.forEach(j,this),this.reset(!0)}function x(l){if(l){var h=l[ct];if(h)return h.call(l);if(typeof l.next=="function")return l;if(!isNaN(l.length)){var k=-1,E=function y(){for(;++k<l.length;)if(T.call(l,k))return y.value=l[k],y.done=!1,y;return y.value=N,y.done=!0,y};return E.next=E}}return{next:d}}function d(){return{value:N,done:!0}}return nt.prototype=z.constructor=X,X.constructor=nt,X[c]=nt.displayName="GeneratorFunction",b.isGeneratorFunction=function(l){var h=typeof l=="function"&&l.constructor;return!!h&&(h===nt||(h.displayName||h.name)==="GeneratorFunction")},b.mark=function(l){return Object.setPrototypeOf?Object.setPrototypeOf(l,X):(l.__proto__=X,c in l||(l[c]="GeneratorFunction")),l.prototype=Object.create(z),l},b.awrap=function(l){return{__await:l}},Q(dt.prototype),dt.prototype[gt]=function(){return this},b.AsyncIterator=dt,b.async=function(l,h,k,E){var y=new dt(ft(l,h,k,E));return b.isGeneratorFunction(h)?y:y.next().then(function(_){return _.done?_.value:y.next()})},Q(z),z[c]="Generator",z[ct]=function(){return this},z.toString=function(){return"[object Generator]"},b.keys=function(l){var h=[];for(var k in l)h.push(k);return h.reverse(),function E(){for(;h.length;){var y=h.pop();if(y in l)return E.value=y,E.done=!1,E}return E.done=!0,E}},b.values=x,$.prototype={constructor:$,reset:function(l){if(this.prev=0,this.next=0,this.sent=this._sent=N,this.done=!1,this.delegate=null,this.method="next",this.arg=N,this.tryEntries.forEach(M),!l)for(var h in this)h.charAt(0)==="t"&&T.call(this,h)&&!isNaN(+h.slice(1))&&(this[h]=N)},stop:function(){this.done=!0;var l=this.tryEntries[0].completion;if(l.type==="throw")throw l.arg;return this.rval},dispatchException:function(l){if(this.done)throw l;var h=this;function k(J,O){return _.type="throw",_.arg=l,h.next=J,O&&(h.method="next",h.arg=N),!!O}for(var E=this.tryEntries.length-1;E>=0;--E){var y=this.tryEntries[E],_=y.completion;if(y.tryLoc==="root")return k("end");if(y.tryLoc<=this.prev){var rt=T.call(y,"catchLoc"),w=T.call(y,"finallyLoc");if(rt&&w){if(this.prev<y.catchLoc)return k(y.catchLoc,!0);if(this.prev<y.finallyLoc)return k(y.finallyLoc)}else if(rt){if(this.prev<y.catchLoc)return k(y.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<y.finallyLoc)return k(y.finallyLoc)}}}},abrupt:function(l,h){for(var k=this.tryEntries.length-1;k>=0;--k){var E=this.tryEntries[k];if(E.tryLoc<=this.prev&&T.call(E,"finallyLoc")&&this.prev<E.finallyLoc){var y=E;break}}y&&(l==="break"||l==="continue")&&y.tryLoc<=h&&h<=y.finallyLoc&&(y=null);var _=y?y.completion:{};return _.type=l,_.arg=h,y?(this.method="next",this.next=y.finallyLoc,q):this.complete(_)},complete:function(l,h){if(l.type==="throw")throw l.arg;return l.type==="break"||l.type==="continue"?this.next=l.arg:l.type==="return"?(this.rval=this.arg=l.arg,this.method="return",this.next="end"):l.type==="normal"&&h&&(this.next=h),q},finish:function(l){for(var h=this.tryEntries.length-1;h>=0;--h){var k=this.tryEntries[h];if(k.finallyLoc===l)return this.complete(k.completion,k.afterLoc),M(k),q}},catch:function(l){for(var h=this.tryEntries.length-1;h>=0;--h){var k=this.tryEntries[h];if(k.tryLoc===l){var E=k.completion;if(E.type==="throw"){var y=E.arg;M(k)}return y}}throw new Error("illegal catch attempt")},delegateYield:function(l,h,k){return this.delegate={iterator:x(l),resultName:h,nextLoc:k},this.method==="next"&&(this.arg=N),q}},b}(et.exports);try{regeneratorRuntime=r}catch{Function("r","regeneratorRuntime = r")(r)}},o0o1:function(et,ot,F){et.exports=F("ls82")}});
//# sourceMappingURL=/s/files/1/0603/2094/0289/t/7/assets/js-trackifyx.js.map?v=63269946540325935281649832812
